System.register(["./chakra-legacy-l4WHB1Dd.js","./index-legacy-4KUy5Ppp.js","./react-legacy-hdXM3JFv.js","./use-templates-legacy-WS42Gr7q.js"],(function(e,n){"use strict";var t,a,i,s,o,l,r,c,d,h,m,p,u,j,x,g,f,v,y,C,b,w,z,O,k,S,I,N,M,L,R,B,H,T,A,E,U,P,V,F,D,$,J,W,G,q,Y,_,K,Z,Q,X,ee,ne,te,ae,ie,se,oe,le,re,ce;return{setters:[e=>{t=e.ax,a=e.j,i=e.O,s=e.as,o=e.af,l=e.B,r=e.ar,c=e.c,d=e.ay,h=e.az,m=e.a4,p=e.aA,u=e.a3,j=e.aB,x=e.aC,g=e.a5,f=e.a6,v=e.aD,y=e.a7,C=e.aE,b=e.$,w=e.aF,z=e.a1,O=e.a2,k=e.g},e=>{S=e.L,I=e.S,N=e.d,M=e.u,L=e.e,R=e.f,B=e.g,H=e.h,T=e.i,A=e.c,E=e.j,U=e.k,P=e.r,V=e.l,F=e.a,D=e.m,$=e.n,J=e.o,W=e.p,G=e.q,q=e.t,Y=e.v,_=e.w,K=e.I,Z=e.x,Q=e.G,X=e.y,ee=e.R,ne=e.z,te=e.E},e=>{ae=e.u,ie=e.r,se=e.p},e=>{oe=e.u,le=e.R,re=e.a,ce=e.b}],execute:function(){function n(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(e)}function de(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"},child:[]}]})(e)}function he(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"},child:[]}]})(e)}function me(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"},child:[]}]})(e)}function pe(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"},child:[]}]})(e)}function ue(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"},child:[]}]})(e)}function je(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"},child:[]}]})(e)}function xe(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"},child:[]}]})(e)}function ge(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"},child:[]}]})(e)}function fe(e){const{optionalName:t,onChange:r}=e,{t:c}=ae(),d=oe(),h=(e,n)=>[{type:"select",label:c("Language"),value:e,options:Object.entries(S).reduce(((e,n)=>({...e,[n[0]]:d(n[1])})),{}),disabledOptions:Object.keys(S).filter((e=>I.includes(e)||t.some((n=>n[0]===e)))).filter((n=>n!==e)),onChange:n=>p(e,n)},{type:"input",label:c("Name"),value:n,onChange:n=>u(e,n),validator:e=>!!e}],m=()=>{const e=Object.keys(S).filter((e=>!I.includes(e)&&!t.some((n=>n[0]===e))));e.includes("ko")?r([...t,["ko",""]]):r([...t,[e[0],""]])},p=(e,n)=>{r(t.map((t=>t[0]===e?[n,t[1]]:t)))},u=(e,n)=>{r(t.map((t=>t[0]===e?[t[0],n]:t)))};return a.jsxs(a.Fragment,{children:[0===t.length&&a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(me,{}),onClick:m,w:"100%",my:2,children:c("Add more translations")}),t.map((([e,i],d,p)=>a.jsxs(s,{sx:{w:"100%","& > div:first-of-type":{flex:1}},children:[a.jsx(le,{fields:h(e,i),noLabel:d>0}),d===p.length-1?a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Add translation"),title:c("Add translation"),onClick:m,icon:a.jsx(me,{})}):a.jsx(l,{minW:8}),a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Remove this translation"),title:c("Remove this translation"),onClick:()=>(e=>{r(t.filter((n=>n[0]!==e)))})(e),icon:a.jsx(n,{})})]},e)))]})}function ve(){const{t:e}=ae(),n=oe(),t=N(),{company:i,newCompany:s,companyName:o,companyOptionalName:l}=M((e=>e.ticket)),d=re(),h=[{type:"select",label:e("Company"),value:i,options:{...d,[e("New")]:{new:e("Add a company...")}},disabledOptions:[""],onChange:e=>t(L(e))},{type:"input",label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:s,onChange:e=>t(R(e)),hidden:"new"!==i}],m=I.map((e=>({type:"input",label:n(S[e]),value:o[e],onChange:n=>t(B({lang:e,name:n}))})));return a.jsxs(H,{children:[a.jsx(T,{children:a.jsx(r,{as:"h5",size:"sm",children:e("Railway company")})}),a.jsx(c.div,{px:1,children:a.jsxs(A,{direction:"column",children:[a.jsx(le,{fields:h}),"new"===i&&a.jsx(le,{fields:m}),"new"===i&&a.jsx(fe,{optionalName:l,onChange:e=>t(E(e))})]})})]})}e("default",(function(){const{t:e}=ae(),n=se(),t=N(),[o,l]=ie.useState(!1);return a.jsxs(ee,{sx:Ue,children:[a.jsxs(k,{children:[a.jsx(Ee,{}),a.jsx(ve,{}),a.jsx(ke,{})]}),a.jsxs(k,{children:[a.jsx(i,{size:"sm",onClick:()=>{P.isStandaloneWindow()?n("/"):P.openApp("rmg-templates")},children:e("Back to list")}),a.jsxs(s,{ml:"auto",children:[a.jsx(i,{size:"sm",variant:"outline",onClick:()=>{t(ne()),P.event(te.RESET_TICKETS,{})},children:e("Reset")}),a.jsx(i,{size:"sm",colorScheme:"primary",onClick:()=>l(!0),children:e("Submit")})]})]}),a.jsx(Ae,{isOpen:o,onClose:()=>l(!1)})]})}));const ye=e=>new Promise((n=>{const t=new FileReader;t.onloadend=()=>n(t.result),t.readAsText(e)})),Ce={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function be(e){const{company:n,templateEntry:t,onLineChange:l,onNewLineChange:r,onMajorFlagChange:c,onLineNameChange:p,onOptionalNameChange:u,onParamChange:j,onParamImport:x,onRemove:g}=e,{line:f,newLine:v,majorUpdate:y,templateName:C,optionalName:b,param:w}=t,{t:z}=ae(),O=oe(),{templates:k}=ce(n),N=ie.useRef(null),M={"":z("Please select..."),...""===n||"new"===n?{}:k.reduce(((e,n)=>({...e,[n.filename]:O(n.name)})),{}),new:z("Add a line...")},L=[{type:"select",label:z("Line"),value:f,options:M,disabledOptions:[""],onChange:e=>l(e),minW:150},{type:"input",label:z("Line code"),placeholder:"e.g. twl, gz1, sh1",value:v,onChange:e=>r(e),hidden:"new"!==f},{type:"custom",label:z("Major update"),component:a.jsx(U,{selections:[{label:z("Yes"),value:!0},{label:z("No"),value:!1}],defaultValue:y,onChange:e=>c(e)}),hidden:"new"===f}],R=I.map((e=>({type:"input",label:O(S[e]),value:C[e],onChange:n=>p(e,n)})));return a.jsxs(A,{sx:Ce,children:[a.jsx(o,{size:"sm",variant:"ghost",icon:a.jsx(ge,{}),"aria-label":z("Remove this line"),title:z("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:g}),a.jsxs(d,{spacing:0,children:[a.jsx(le,{fields:[...L,...R],minW:110}),a.jsx(fe,{optionalName:b,onChange:u})]}),a.jsx(d,{children:w?a.jsxs(a.Fragment,{children:[a.jsx(h,{as:ue,boxSize:10}),a.jsxs(m,{as:"i",fontSize:"xs",children:["(",z("Size"),": ",JSON.stringify(w).length," ",z("chars"),")"]}),a.jsx(i,{size:"sm",onClick:()=>j(void 0),children:z("Remove")})]}):a.jsxs(a.Fragment,{children:[a.jsx(m,{as:"i",fontSize:"sm",children:z("Import from")}),a.jsxs(s,{spacing:1,children:[a.jsx(i,{size:"sm",onClick:x,children:"RMG"}),a.jsx(i,{size:"sm",onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},children:z("Local")}),a.jsx("input",{ref:N,type:"file",accept:".json",onChange:async e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(console.log("handleFileUpload():: received file",t),t){if("application/json"!==t.type)return alert("Invalid file type!"),void(e.target.value="");try{const e=await ye(t);j(JSON.parse(e))}catch(a){alert("Invalid file!"),e.target.value=""}}}})]})]})})]})}const we="rmg-bridge--",ze={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Oe(e){const{templateId:n,onClose:t,onImport:i}=e,[s]=ie.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:P.getAppName(),parentId:s});return ie.useEffect((()=>{const e=new BroadcastChannel(we+s);return e.onmessage=e=>{const{event:n,data:a}=e.data;console.log("[rmg-templates] Received event from RMG app clip:",n),"CLOSE"===n?t():"IMPORT"===n&&i(a)},()=>{e.close()}}),[n]),a.jsx(V,{isOpen:!!n,onClose:t,sx:ze,children:a.jsx("iframe",{src:o,loading:"lazy"})})}function ke(){const{t:e}=ae(),n=N(),{company:t,templates:o}=M((e=>e.ticket)),{templates:l,isLoading:d}=ce(t),[m,u]=ie.useState();return a.jsxs(H,{children:[d&&a.jsx(F,{isIndeterminate:!0}),a.jsxs(T,{children:[a.jsx(r,{as:"h5",size:"sm",children:e("Add or update templates")}),a.jsx(p,{hasArrow:!0,label:e("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:a.jsx("span",{children:a.jsx(h,{as:de,ml:1})})})]}),a.jsx(c.div,{px:1,transform:"translateZ(0)",children:o.map((e=>a.jsx(be,{company:t,templateEntry:e,onLineChange:t=>((e,t)=>{const a=l.find((e=>e.filename===t));n(_({id:e,line:t,name:null==a?void 0:a.name}))})(e.id,t),onNewLineChange:t=>n(D({id:e.id,newLine:t})),onMajorFlagChange:t=>n($({id:e.id,majorUpdate:t})),onLineNameChange:(t,a)=>n(J({id:e.id,lang:t,name:a})),onOptionalNameChange:t=>n(W({id:e.id,optionalName:t})),onParamChange:t=>n(G({id:e.id,param:t})),onParamImport:()=>u(e.id),onRemove:()=>n(q(e.id))},e.id)))}),a.jsx(s,{justifyContent:"flex-end",children:a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(me,{}),onClick:()=>n(Y()),children:e("Add item")})}),a.jsx(Oe,{templateId:m,onClose:()=>u(void 0),onImport:e=>{m&&n(G({id:m,param:e})),u(void 0)}})]})}function Se(e){const{companyErrors:n,templateErrors:t,onClose:o}=e,{t:l}=ae(),c=oe();return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(m,{children:l("Your inputs contain the following errors. Please fix it before submitting.")}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Railway company")}),a.jsx(j,{"aria-label":"List of company errors",children:n.map(((e,n)=>a.jsx(x,{children:c(K[e])},n)))})]}),Object.values(t).flat().length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Templates")}),a.jsx(j,{"aria-label":"List of template errors",children:Object.entries(t).map((([e,n])=>a.jsxs(x,{children:[e,a.jsx(j,{children:n.map(((e,n)=>a.jsx(x,{children:c(K[e])},n)))})]},e)))})]})]}),a.jsx(g,{children:a.jsx(s,{children:a.jsx(i,{colorScheme:"primary",onClick:o,children:l("Go back")})})})]})}const Ie={hasDiagramInStation:!1,isOpened:!1,soonToBeOpened:!1,source:"",link:"",comments:"",majorUpdateComments:{}},Ne=()=>Ie,Me=e=>{const n=e.isOpened||e.soonToBeOpened;return e.hasDiagramInStation&&n},Le=e=>{const n=Me(e),t="STATION_UPLOAD_IMAGE"===e.source||e.source&&e.link,a=Object.values(e.majorUpdateComments).every((e=>!!e));return Boolean(n&&t&&e.comments&&a)},Re=e=>{const{hasDiagramInStation:n,isOpened:t,soonToBeOpened:a,source:i,link:s,comments:o,majorUpdateComments:l}=e;return`| Item | Value |\n|---|---|\n| Route map in stations | ${n?"Yes":"No"} |\n|    Opening status     | ${t?"Opened":a?"To be opened":"Not yet opened"} |\n| Reference source type | ${i?Z[i].en:"Not selected"} |\n|     Reference link    | ${s} |\n|     Justification     | ${o.replaceAll("\n","<br>")} |\n${Object.entries(l).map((([e,n])=>`| Major update of ${e} | ${n.replaceAll("\n","<br.")} |`)).join("\n")}`},Be=e=>{var n;return!(null===(n=e.match(/^https?:\/\//))||void 0===n||!n[0])};function He(e){const{justification:n,onJustificationUpdate:t,onNext:s}=e,{t:o}=ae(),l=oe(),r=[{label:o("Yes"),value:!0},{label:o("No"),value:!1}],c=Object.fromEntries([["",o("Please select...")],...Object.entries(Z).map((([e,n],t)=>[e,`${t+1}. ${l(n)}`]))]),d=[{type:"custom",label:o("Have all of the lines been officially opened?"),component:a.jsx(U,{selections:r,defaultValue:n.isOpened,onChange:e=>t("isOpened",e)})},{type:"custom",label:o("Are they soon to be opened? Are all of the station names finalised?"),component:a.jsx(U,{selections:r,defaultValue:n.soonToBeOpened,onChange:e=>t("soonToBeOpened",e)}),hidden:n.isOpened},{type:"custom",label:o("Is route map (network map) displayed in the stations of these lines?"),component:a.jsx(U,{selections:r,defaultValue:n.hasDiagramInStation,onChange:e=>t("hasDiagramInStation",e)})}],h=[{type:"select",label:o("Reference source"),options:c,disabledOptions:[""],value:n.source,onChange:e=>t("source",e)},{type:"input",value:n.link,label:o("Reference link"),placeholder:o("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:e=>t("link",e),validator:Be,isDisabled:"STATION_UPLOAD_IMAGE"===n.source},{type:"textarea",value:n.comments,label:o("Justification"),placeholder:o("Briefly describe your changes and provide justification"),onChange:e=>t("comments",e)}],p=Object.entries(n.majorUpdateComments).map((([e,a])=>({type:"textarea",value:a,label:o("Justification for major update of")+" "+e,placeholder:o("Briefly describe your changes and provide justification"),onChange:a=>t("majorUpdateComments",{...n.majorUpdateComments,[e]:a})}))),j=Me(n),x=Le(n);return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(m,{children:o("Please complete the questionnaire below.")}),a.jsx(le,{fields:d,minW:"full"}),j?a.jsxs(a.Fragment,{children:[a.jsx(m,{children:o("Please provide suitable source and justification.")}),a.jsx(le,{fields:[...h,...p],minW:"full"})]}):a.jsx(m,{as:"i",children:o("Sorry. The templates uploaded do not meet our acceptance criteria.")})]}),a.jsx(g,{children:a.jsx(i,{colorScheme:"primary",onClick:s,rightIcon:a.jsx(xe,{}),isDisabled:!x,children:o("Next")})})]})}function Te(e){var n;const{companyName:t,companyBlock:s,templateBlocks:o,justification:l,onPrev:r,onClose:c}=e,{t:d}=ae(),p=f("primary.500","primary.300"),j=[Re(l),Q,null!==(n=null==s?void 0:s.outerHTML)&&void 0!==n?n:"",...o.map((e=>e.outerHTML))].join("\n\n"),C=new URLSearchParams({template:"new-templates-request.md",labels:"resources",title:"Resources: New templates of "+t});return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(m,{children:d("Follow the instructions below to open an Issue")+":"}),a.jsxs(v,{children:[a.jsxs(x,{children:[d("Open")," ",a.jsxs(y,{color:p,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+C.toString(),isExternal:!0,children:["Issue: New Templates Request ",a.jsx(h,{as:he})]})]}),a.jsxs(x,{children:[d("Click copy button and paste into issue body")," ",a.jsx(i,{size:"xs",leftIcon:a.jsx(pe,{}),onClick:async()=>{await navigator.clipboard.writeText(j)},children:d("Copy")})]})]})]}),a.jsxs(g,{children:[a.jsx(i,{variant:"ghost",onClick:r,mr:"auto",leftIcon:a.jsx(je,{}),children:d("Previous")}),a.jsx(i,{colorScheme:"primary",onClick:c,children:d("Close")})]})]})}function Ae(e){const{isOpen:n,onClose:t}=e,{t:i}=ae(),[s,o]=ie.useState([]),[l,r]=ie.useState({}),[c,d]=ie.useState(Ne()),[h,m]=ie.useState(!1),{coreCompanyConfig:p,otherCompanyConfig:u,templateList:j}=M((e=>e.app)),x=M((e=>e.ticket)),g=X.getCompanyEnglishName(x,[...p,...u]),f=X.getCompanyBlock(x),v=X.getTemplateBlocks(x),y=(e,n)=>{d((t=>({...t,[e]:n})))};ie.useEffect((()=>{if(n){o(X.getCompanyErrors(x)),r(X.getTemplateErrors(x));const e=X.getMajorUpdateNames(x,j).reduce(((e,n)=>({...e,[n]:""})),{});y("majorUpdateComments",e)}else m(!1)}),[n]);const k=s.length>0||Object.values(l).flat().length>0,S=!k&&!h;return a.jsxs(C,{blockScrollOnMount:!1,isOpen:n,onClose:t,scrollBehavior:"inside",children:[a.jsx(b,{}),a.jsxs(w,{children:[a.jsx(z,{children:i("Submit templates")}),a.jsx(O,{}),k&&a.jsx(Se,{companyErrors:s,templateErrors:l,onClose:t}),S&&a.jsx(He,{justification:c,onJustificationUpdate:y,onNext:()=>m(!0)}),!k&&h&&a.jsx(Te,{companyName:g,companyBlock:f,templateBlocks:v,justification:c,onPrev:()=>m(!1),onClose:t})]})]})}function Ee(){const{t:e}=ae();return a.jsxs(H,{children:[a.jsx(T,{children:a.jsx(r,{as:"h5",size:"sm",children:e("Acceptance criteria")})}),a.jsxs(c.div,{px:5,children:[a.jsx(m,{children:e("acceptanceCriteria.preamble")}),a.jsxs(j,{children:[a.jsx(x,{children:e("acceptanceCriteria.item1")}),a.jsx(x,{children:e("acceptanceCriteria.item2")})]})]})]})}const Ue={width:{base:"100%",md:520},alignSelf:"center","& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto",bg:"inherit"},"& > div:nth-of-type(2)":{my:2}}}}}));
