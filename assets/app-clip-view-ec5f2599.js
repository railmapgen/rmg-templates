import{j as e,t as v,v as R,X as S,Y as L,r as g}from"./chakra-4d1cedbe.js";import{u as _,r as m,R as T,a as y}from"./index-326f6911.js";import{P as A,T as $}from"./templates-grid-bdf007d4.js";import{u as O,k as M,r}from"./react-d5c86316.js";import{E as p}from"./use-templates-ba728bbf.js";const b="rmg-templates-bridge--";function H(){const{t:i}=O(),[d]=M(),E=d.get("parentId"),o=d.get("parentComponent"),{selectedCompany:c}=_(t=>t.app),[a,l]=r.useState(),[P,u]=r.useState(!1),[x,f]=r.useState(!1),n=r.useRef();r.useEffect(()=>{var t;return n.current=new BroadcastChannel(b+E),m.event(p.APP_CLIP_VIEW_OPENED,{parentComponent:o}),console.log(`[${(t=n.current)==null?void 0:t.name}] App clip connection established, parentComponent=${o}`),()=>{var s;(s=n.current)==null||s.close()}},[]),r.useEffect(()=>{l(void 0)},[c]);const C=async()=>{var t,s;console.log(`[${(t=n.current)==null?void 0:t.name}] Emitting IMPORT event, company=${c}, template=${a}`);try{u(!0);const j=await(await fetch(`/rmg-templates/resources/templates/${c}/${a}.json`)).text();(s=n.current)==null||s.postMessage({event:"IMPORT",meta:{selectedCompany:c,selectedTemplate:a},data:j}),m.event(p.APP_CLIP_VIEW_IMPORT,{parentComponent:o})}catch(h){f(!0)}finally{u(!1),l(void 0)}},I=()=>{var t,s;console.log(`[${(t=n.current)==null?void 0:t.name}] Emitting CLOSE event`),(s=n.current)==null||s.postMessage({event:"CLOSE"}),m.event(p.APP_CLIP_VIEW_CLOSED,{parentComponent:o}),l(void 0),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[P&&e.jsx(y,{isIndeterminate:!0}),x&&e.jsxs(v,{status:"error",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[e.jsx(R,{}),i("Unable to import selected template.")]}),e.jsx(A,{}),e.jsx($,{selectedTemplate:a,onTemplateSelect:l})]}),e.jsx(S,{}),e.jsxs(L,{p:2,justifyContent:"flex-end",children:[e.jsx(g,{size:"sm",onClick:I,children:i("Close")}),e.jsx(g,{size:"sm",colorScheme:"primary",isDisabled:!a,onClick:C,children:i("Import")})]})]})}export{H as default};
