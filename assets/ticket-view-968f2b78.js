import{u as M,S as Q,L as Z,j as e,K as ee,H as T,M as te,v as B,N as z,b as j,O as ie,V as oe,Q as V,U as N,x,w as P,r as R,W as re,h as le,X as J,Y as ce,Z as _,_ as U,$ as E,a0 as G,a1 as de,a2 as me,a3 as pe,a4 as he,a5 as ue,a6 as fe,a7 as ge,a8 as xe,s as je,J as ve}from"./vendor-dd6be2bd.js";import{a as D,u as k,b as Ce,c as ye,d as be,e as we,f as Me,g as Se,h as Y,r as ze,i as Ie,j as Le,t as I,k as Ee}from"./index-b9c98017.js";import{u as W,a as ae,I as K,G as Ne,E as ke}from"./use-templates-d4d9d102.js";function Oe(){const{t,i18n:a}=M(),n=W(),o=D(),{companyConfig:i}=k(s=>s.app),{company:d,newCompany:r,companyName:m}=k(s=>s.ticket),c={...i.map(s=>[s.id,n(s.name)]).sort((s,h)=>s[1].localeCompare(h[1],a.languages[0])).reduce((s,h)=>({...s,[h[0]]:h[1]}),{"":t("Please select...")}),new:t("Add a company...")},u=[{type:"select",label:t("Company"),value:d,options:c,disabledOptions:[""],onChange:s=>o(Ce(s))},{type:"input",label:t("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:r,onChange:s=>o(ye(s)),hidden:d!=="new"}],l=Q.map(s=>({type:"input",label:n(Z[s]),value:m[s],onChange:h=>o(be({lang:s,name:h}))}));return e.jsxs(ee,{as:"section",children:[e.jsx(T,{as:"h5",size:"sm",mb:2,children:t("Railway company")}),e.jsxs(te,{direction:"column",children:[e.jsx(B,{fields:u}),d==="new"&&e.jsx(B,{fields:l})]})]})}const Re=t=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsText(t)});var ne={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},X=z.createContext&&z.createContext(ne),w=globalThis&&globalThis.__assign||function(){return w=Object.assign||function(t){for(var a,n=1,o=arguments.length;n<o;n++){a=arguments[n];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},w.apply(this,arguments)},Te=globalThis&&globalThis.__rest||function(t,a){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&a.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(t);i<o.length;i++)a.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]]);return n};function se(t){return t&&t.map(function(a,n){return z.createElement(a.tag,w({key:n},a.attr),se(a.child))})}function S(t){return function(a){return z.createElement(Be,w({attr:w({},t.attr)},a),se(t.child))}}function Be(t){var a=function(n){var o=t.attr,i=t.size,d=t.title,r=Te(t,["attr","size","title"]),m=i||n.size||"1em",c;return n.className&&(c=n.className),t.className&&(c=(c?c+" ":"")+t.className),z.createElement("svg",w({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,o,r,{className:c,style:w(w({color:t.color||n.color},n.style),t.style),height:m,width:m,xmlns:"http://www.w3.org/2000/svg"}),d&&z.createElement("title",null,d),t.children)};return X!==void 0?z.createElement(X.Consumer,null,function(n){return a(n)}):a(ne)}function Pe(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(t)}function He(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(t)}function Fe(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(t)}function Ae(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(t)}function Ue(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"}}]})(t)}function Je(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(t)}function Ve(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(t)}function _e(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(t)}const Ge={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function De(t){const{company:a,templateEntry:n,onLineChange:o,onNewLineChange:i,onMajorFlagChange:d,onLineNameChange:r,onParamChange:m,onParamImport:c,onRemove:u}=t,{line:l,newLine:s,majorUpdate:h,templateName:v,param:b}=n,{t:f}=M(),C=W(),{templates:H}=ae(a),O=j.useRef(null),F=async p=>{var $;const g=($=p.target.files)==null?void 0:$[0];if(console.log("handleFileUpload():: received file",g),!!g){if(g.type!=="application/json"){alert("Invalid file type!"),p.target.value="";return}try{const q=await Re(g);m(JSON.parse(q))}catch(q){alert("Invalid file!"),p.target.value=""}}},L={"":f("Please select..."),...a===""||a==="new"?{}:H.reduce((p,g)=>({...p,[g.filename]:C(g.name)}),{}),new:f("Add a line...")},A=[{type:"select",label:f("Line"),value:l,options:L,disabledOptions:[""],onChange:p=>o(p),minW:150},{type:"input",label:f("Line code"),placeholder:"e.g. twl, gz1, sh1",value:s,onChange:p=>i(p),hidden:l!=="new"},{type:"switch",label:f("Major update"),isChecked:h,onChange:p=>d(p),hidden:l==="new",oneLine:!0}],y=Q.map(p=>({type:"input",label:C(Z[p]),value:v[p],onChange:g=>r(p,g),minW:p==="en"?260:void 0}));return e.jsxs(te,{sx:Ge,children:[e.jsx(ie,{size:"sm",variant:"ghost",icon:e.jsx(_e,{}),"aria-label":f("Remove this line"),title:f("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:u}),e.jsx(B,{fields:[...A,...y],minW:110}),e.jsx(oe,{children:b?e.jsxs(e.Fragment,{children:[e.jsx(V,{as:Ue,boxSize:10}),e.jsxs(N,{as:"i",fontSize:"xs",children:["(",f("Size"),": ",JSON.stringify(b).length," ",f("chars"),")"]}),e.jsx(x,{size:"sm",onClick:()=>m(void 0),children:f("Remove")})]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{as:"i",fontSize:"sm",children:f("Import from")}),e.jsxs(P,{spacing:1,children:[e.jsx(x,{size:"sm",onClick:c,children:"RMG"}),e.jsx(x,{size:"sm",onClick:()=>{var p;return(p=O.current)==null?void 0:p.click()},children:f("Local")}),e.jsx("input",{ref:O,type:"file",accept:".json",onChange:F})]})]})})]})}const We="rmg-bridge--",$e={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function qe(t){const{templateId:a,onClose:n,onImport:o}=t,[i]=j.useState(crypto.randomUUID()),d="/rmg/import?"+new URLSearchParams({parentComponent:R.getAppName(),parentId:i});return j.useEffect(()=>{const r=new BroadcastChannel(We+i);return r.onmessage=m=>{const{event:c,data:u}=m.data;console.log("[rmg-templates] Received event from RMG app clip:",c),c==="CLOSE"?n():c==="IMPORT"&&o(u)},()=>{r.close()}},[a]),e.jsx(re,{isOpen:!!a,onClose:n,sx:$e,children:e.jsx("iframe",{src:d,loading:"lazy"})})}function Ye(){const{t}=M(),a=D(),{company:n,templates:o}=k(l=>l.ticket),{templates:i,isLoading:d}=ae(n),[r,m]=j.useState(),c=(l,s)=>{const h=i.find(v=>v.filename===s);a(Le({id:l,line:s,name:h==null?void 0:h.name}))},u=l=>{r&&a(Y({id:r,param:l})),m(void 0)};return e.jsxs(ee,{as:"section",mt:3,position:"relative",children:[d&&e.jsx(le,{isIndeterminate:!0}),e.jsxs(J,{children:[e.jsx(T,{as:"h5",size:"sm",mb:2,children:t("Add or update templates")}),e.jsx(ce,{hasArrow:!0,label:t("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:e.jsx("span",{children:e.jsx(V,{as:Pe,ml:1})})})]}),o.map(l=>e.jsx(De,{company:n,templateEntry:l,onLineChange:s=>c(l.id,s),onNewLineChange:s=>a(we({id:l.id,newLine:s})),onMajorFlagChange:s=>a(Me({id:l.id,majorUpdate:s})),onLineNameChange:(s,h)=>a(Se({id:l.id,lang:s,name:h})),onParamChange:s=>a(Y({id:l.id,param:s})),onParamImport:()=>m(l.id),onRemove:()=>a(ze(l.id))},l.id)),e.jsx(P,{justifyContent:"flex-end",children:e.jsx(x,{variant:"ghost",size:"sm",leftIcon:e.jsx(Fe,{}),onClick:()=>a(Ie()),children:t("Add item")})}),e.jsx(qe,{templateId:r,onClose:()=>m(void 0),onImport:u})]})}function Ke(t){const{companyErrors:a,templateErrors:n,onClose:o}=t,{t:i}=M(),d=W();return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(N,{children:i("Your inputs contain the following errors. Please fix it before submitting.")}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{as:"h5",size:"sm",my:2,children:i("Railway company")}),e.jsx(U,{"aria-label":"List of company errors",children:a.map((r,m)=>e.jsx(E,{children:d(K[r])},m))})]}),Object.values(n).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{as:"h5",size:"sm",my:2,children:i("Templates")}),e.jsx(U,{"aria-label":"List of template errors",children:Object.entries(n).map(([r,m])=>e.jsxs(E,{children:[r,e.jsx(U,{children:m.map((c,u)=>e.jsx(E,{children:d(K[c])},u))})]},r))})]})]}),e.jsx(G,{children:e.jsx(P,{children:e.jsx(x,{colorScheme:"primary",onClick:o,children:i("Go back")})})})]})}function Xe(t){const{justification:a,majorUpdateJustifications:n,onJustificationChange:o,onMajorUpdateJustificationChange:i,onNext:d}=t,{t:r}=M(),m=[{type:"textarea",value:a,label:r("Justification"),placeholder:r("Briefly describe your changes and provide justification"),onChange:o}],c=Object.entries(n).map(([l,s])=>({type:"textarea",value:s,label:r("Justification for major update of")+" "+l,placeholder:r("Briefly describe your changes and provide justification"),onChange:h=>i(l,h)})),u=!a||Object.values(n).some(l=>!l);return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(N,{children:r("Please provide suitable source and justification.")}),e.jsx(B,{fields:[...m,...c],minW:"full"})]}),e.jsx(G,{children:e.jsx(x,{colorScheme:"primary",onClick:d,rightIcon:e.jsx(Ve,{}),isDisabled:u,children:r("Next")})})]})}function Qe(t){var v;const{companyName:a,companyBlock:n,templateBlocks:o,justification:i,majorUpdateJustifications:d,onPrev:r,onClose:m}=t,{t:c}=M(),u=de("primary.500","primary.300"),l=[`**Justification:** ${i||"(REPLACE ME)"}`,Object.entries(d).map(([b,f])=>`- Major update of ${b}: ${f}`).join(`
`),Ne,(v=n==null?void 0:n.outerHTML)!=null?v:"",...o.map(b=>b.outerHTML)].join(`

`),s=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+a}),h=async()=>{await navigator.clipboard.writeText(l)};return e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(N,{children:c("Follow the instructions below to open an Issue")+":"}),e.jsxs(me,{children:[e.jsxs(E,{children:[c("Open")," ",e.jsxs(pe,{color:u,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+s.toString(),isExternal:!0,children:["Issue: New Templates Request ",e.jsx(V,{as:He})]})]}),e.jsxs(E,{children:[c("Click copy button and paste into issue body")," ",e.jsx(x,{size:"xs",leftIcon:e.jsx(Ae,{}),onClick:h,children:c("Copy")})]})]})]}),e.jsxs(G,{children:[e.jsx(x,{variant:"ghost",onClick:r,mr:"auto",leftIcon:e.jsx(Je,{}),children:c("Previous")}),e.jsx(x,{colorScheme:"primary",onClick:m,children:c("Close")})]})]})}function Ze(t){const{isOpen:a,onClose:n}=t,{t:o}=M(),[i,d]=j.useState([]),[r,m]=j.useState({}),[c,u]=j.useState(""),[l,s]=j.useState({}),[h,v]=j.useState(!1),{companyConfig:b,templateList:f}=k(y=>y.app),C=k(y=>y.ticket),H=I.getCompanyEnglishName(C,b),O=I.getCompanyBlock(C),F=I.getTemplateBlocks(C);j.useEffect(()=>{if(a){d(I.getCompanyErrors(C)),m(I.getTemplateErrors(C));const y=I.getMajorUpdateNames(C,f).reduce((p,g)=>({...p,[g]:""}),{});s(y)}else u(""),s({}),v(!1)},[a]);const L=i.length>0||Object.values(r).flat().length>0,A=!L&&!h;return e.jsxs(he,{blockScrollOnMount:!1,isOpen:a,onClose:n,scrollBehavior:"inside",children:[e.jsx(ue,{}),e.jsxs(fe,{children:[e.jsx(ge,{children:o("Submit templates")}),e.jsx(xe,{}),L&&e.jsx(Ke,{companyErrors:i,templateErrors:r,onClose:n}),A&&e.jsx(Xe,{justification:c,majorUpdateJustifications:l,onJustificationChange:u,onMajorUpdateJustificationChange:(y,p)=>s(g=>({...g,[y]:p})),onNext:()=>v(!0)}),!L&&h&&e.jsx(Qe,{companyName:H,companyBlock:O,templateBlocks:F,justification:c,majorUpdateJustifications:l,onPrev:()=>v(!1),onClose:n})]})]})}const et={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function st(){const{t}=M(),a=je(),n=D(),[o,i]=j.useState(!1),d=()=>{R.isStandaloneWindow()?a("/"):R.openApp("rmg-templates")},r=()=>{n(Ee()),R.event(ke.RESET_TICKETS,{})};return e.jsxs(ve,{sx:et,children:[e.jsxs(J,{children:[e.jsx(Oe,{}),e.jsx(Ye,{})]}),e.jsxs(J,{children:[e.jsx(x,{size:"sm",onClick:d,children:t("Back to list")}),e.jsxs(P,{ml:"auto",children:[e.jsx(x,{size:"sm",variant:"outline",onClick:r,children:t("Reset")}),e.jsx(x,{size:"sm",colorScheme:"primary",onClick:()=>i(!0),children:t("Submit")})]})]}),e.jsx(Ze,{isOpen:o,onClose:()=>i(!1)})]})}export{st as default};
