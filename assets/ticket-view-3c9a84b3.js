import{u as b,S as q,L as Y,j as e,K,H as O,M as Q,v as k,N as M,O as ae,Q as ne,h as se,U as J,V as ie,W as X,w as U,x,X as A,Y as _,Z as P,_ as z,$ as V,a0 as oe,a1 as re,a2 as le,b as w,a3 as ce,a4 as de,a5 as me,a6 as ue,a7 as he,s as pe,J as fe,r as F}from"./vendor-04300e5c.js";import{a as G,u as T,b as ge,c as je,d as xe,e as ve,f as ye,g as Ce,h as be,r as we,i as Me,j as Se,t as L,k as Ee}from"./index-0955f94e.js";import{u as W,a as Z,I as D,G as Le,E as Ne}from"./use-templates-b1224084.js";function ze(){const{t,i18n:a}=b(),n=W(),o=G(),{companyConfig:i}=T(l=>l.app),{company:d,newCompany:c,companyName:r}=T(l=>l.ticket),s={...i.map(l=>[l.id,n(l.name)]).sort((l,p)=>l[1].localeCompare(p[1],a.languages[0])).reduce((l,p)=>({...l,[p[0]]:p[1]}),{"":t("Please select...")}),new:t("Add a company...")},m=[{type:"select",label:t("Company"),value:d,options:s,disabledOptions:[""],onChange:l=>o(ge(l))},{type:"input",label:t("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:c,onChange:l=>o(je(l)),hidden:d!=="new"}],h=q.map(l=>({type:"input",label:n(Y[l]),value:r[l],onChange:p=>o(xe({lang:l,name:p}))}));return e.jsxs(K,{as:"section",children:[e.jsx(O,{as:"h5",size:"sm",mb:2,children:t("Railway company")}),e.jsxs(Q,{direction:"column",children:[e.jsx(k,{fields:m}),d==="new"&&e.jsx(k,{fields:h})]})]})}const Te=t=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsText(t)});var ee={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},$=M.createContext&&M.createContext(ee),C=globalThis&&globalThis.__assign||function(){return C=Object.assign||function(t){for(var a,n=1,o=arguments.length;n<o;n++){a=arguments[n];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},C.apply(this,arguments)},Oe=globalThis&&globalThis.__rest||function(t,a){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&a.indexOf(o)<0&&(n[o]=t[o]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,o=Object.getOwnPropertySymbols(t);i<o.length;i++)a.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(t,o[i])&&(n[o[i]]=t[o[i]]);return n};function te(t){return t&&t.map(function(a,n){return M.createElement(a.tag,C({key:n},a.attr),te(a.child))})}function S(t){return function(a){return M.createElement(ke,C({attr:C({},t.attr)},a),te(t.child))}}function ke(t){var a=function(n){var o=t.attr,i=t.size,d=t.title,c=Oe(t,["attr","size","title"]),r=i||n.size||"1em",s;return n.className&&(s=n.className),t.className&&(s=(s?s+" ":"")+t.className),M.createElement("svg",C({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,o,c,{className:s,style:C(C({color:t.color||n.color},n.style),t.style),height:r,width:r,xmlns:"http://www.w3.org/2000/svg"}),d&&M.createElement("title",null,d),t.children)};return $!==void 0?M.createElement($.Consumer,null,function(n){return a(n)}):a(ee)}function Ie(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(t)}function Be(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(t)}function Re(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(t)}function He(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(t)}function Pe(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(t)}function Fe(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(t)}function Je(t){return S({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(t)}function Ue(t){const{company:a,templateEntry:n,onLineChange:o,onNewLineChange:i,onMajorFlagChange:d,onLineNameChange:c,onParamChange:r,onRemove:s}=t,{line:m,newLine:h,majorUpdate:l,templateName:p}=n,{t:f}=b(),v=W(),{templates:N}=Z(a),y=async u=>{var j;const g=(j=u.target.files)==null?void 0:j[0];if(console.log("handleFileUpload():: received file",g),!!g){if(g.type!=="application/json"){alert("Invalid file type!"),u.target.value="";return}try{const E=await Te(g);r(JSON.parse(E))}catch(E){alert("Invalid file!"),u.target.value=""}}},I={"":f("Please select..."),...a===""||a==="new"?{}:N.reduce((u,g)=>({...u,[g.filename]:v(g.name)}),{}),new:f("Add a line...")},B=[{type:"select",label:f("Line"),value:m,options:I,disabledOptions:[""],onChange:u=>o(u),minW:150},{type:"custom",label:f("Configuration file"),component:e.jsx(ae,{variant:"flushed",size:"xs",type:"file",accept:".json",onChange:y}),minW:250},{type:"input",label:f("Line code"),placeholder:"e.g. twl, gz1, sh1",value:h,onChange:u=>i(u),hidden:m!=="new"},{type:"switch",label:f("Major update"),isChecked:l,onChange:u=>d(u),hidden:m==="new",oneLine:!0}],R=q.map(u=>({type:"input",label:v(Y[u]),value:p[u],onChange:g=>c(u,g),minW:u==="en"?260:void 0}));return e.jsxs(Q,{position:"relative",direction:"column",children:[e.jsx(ne,{size:"sm",variant:"ghost",icon:e.jsx(Je,{}),"aria-label":f("Remove this line"),title:f("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:s}),e.jsx(k,{fields:[...B,...R],minW:110})]})}function Ae(){const{t}=b(),a=G(),{company:n,templates:o}=T(r=>r.ticket),{templates:i,isLoading:d}=Z(n),c=(r,s)=>{const m=i.find(h=>h.filename===s);a(Se({id:r,line:s,name:m==null?void 0:m.name}))};return e.jsxs(K,{as:"section",mt:3,position:"relative",children:[d&&e.jsx(se,{isIndeterminate:!0}),e.jsxs(J,{children:[e.jsx(O,{as:"h5",size:"sm",mb:2,children:t("Add or update templates")}),e.jsx(ie,{hasArrow:!0,label:t("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:e.jsx("span",{children:e.jsx(X,{as:Ie,ml:1})})})]}),o.map(r=>e.jsx(Ue,{company:n,templateEntry:r,onLineChange:s=>c(r.id,s),onNewLineChange:s=>a(ve({id:r.id,newLine:s})),onMajorFlagChange:s=>a(ye({id:r.id,majorUpdate:s})),onLineNameChange:(s,m)=>a(Ce({id:r.id,lang:s,name:m})),onParamChange:s=>a(be({id:r.id,param:s})),onRemove:()=>a(we(r.id))},r.id)),e.jsx(U,{justifyContent:"flex-end",children:e.jsx(x,{variant:"ghost",size:"sm",leftIcon:e.jsx(Re,{}),onClick:()=>a(Me()),children:t("Add item")})})]})}function _e(t){const{companyErrors:a,templateErrors:n,onClose:o}=t,{t:i}=b(),d=W();return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(_,{children:i("Your inputs contain the following errors. Please fix it before submitting.")}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{as:"h5",size:"sm",my:2,children:i("Railway company")}),e.jsx(P,{"aria-label":"List of company errors",children:a.map((c,r)=>e.jsx(z,{children:d(D[c])},r))})]}),Object.values(n).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{as:"h5",size:"sm",my:2,children:i("Templates")}),e.jsx(P,{"aria-label":"List of template errors",children:Object.entries(n).map(([c,r])=>e.jsxs(z,{children:[c,e.jsx(P,{children:r.map((s,m)=>e.jsx(z,{children:d(D[s])},m))})]},c))})]})]}),e.jsx(V,{children:e.jsx(U,{children:e.jsx(x,{colorScheme:"primary",onClick:o,children:i("Go back")})})})]})}function Ve(t){const{justification:a,majorUpdateJustifications:n,onJustificationChange:o,onMajorUpdateJustificationChange:i,onNext:d}=t,{t:c}=b(),r=[{type:"textarea",value:a,label:c("Justification"),placeholder:c("Briefly describe your changes and provide justification"),onChange:o}],s=Object.entries(n).map(([h,l])=>({type:"textarea",value:l,label:c("Justification for major update of")+" "+h,placeholder:c("Briefly describe your changes and provide justification"),onChange:p=>i(h,p)})),m=!a||Object.values(n).some(h=>!h);return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(_,{children:c("Please provide suitable source and justification.")}),e.jsx(k,{fields:[...r,...s],minW:"full"})]}),e.jsx(V,{children:e.jsx(x,{colorScheme:"primary",onClick:d,rightIcon:e.jsx(Fe,{}),isDisabled:m,children:c("Next")})})]})}function Ge(t){var f;const{companyName:a,companyBlock:n,templateBlocks:o,justification:i,majorUpdateJustifications:d,onPrev:c,onClose:r}=t,{t:s}=b(),m=oe("primary.500","primary.300"),h=[`**Justification:** ${i||"(REPLACE ME)"}`,Object.entries(d).map(([v,N])=>`- Major update of ${v}: ${N}`).join(`
`),Le,(f=n==null?void 0:n.outerHTML)!=null?f:"",...o.map(v=>v.outerHTML)].join(`

`),l=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+a}),p=async()=>{await navigator.clipboard.writeText(h)};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx(_,{children:s("Follow the instructions below to open an Issue")+":"}),e.jsxs(re,{children:[e.jsxs(z,{children:[s("Open")," ",e.jsxs(le,{color:m,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+l.toString(),isExternal:!0,children:["Issue: New Templates Request ",e.jsx(X,{as:Be})]})]}),e.jsxs(z,{children:[s("Click copy button and paste into issue body")," ",e.jsx(x,{size:"xs",leftIcon:e.jsx(He,{}),onClick:p,children:s("Copy")})]})]})]}),e.jsxs(V,{children:[e.jsx(x,{variant:"ghost",onClick:c,mr:"auto",leftIcon:e.jsx(Pe,{}),children:s("Previous")}),e.jsx(x,{colorScheme:"primary",onClick:r,children:s("Close")})]})]})}function We(t){const{isOpen:a,onClose:n}=t,{t:o}=b(),[i,d]=w.useState([]),[c,r]=w.useState({}),[s,m]=w.useState(""),[h,l]=w.useState({}),[p,f]=w.useState(!1),{companyConfig:v,templateList:N}=T(j=>j.app),y=T(j=>j.ticket),I=L.getCompanyEnglishName(y,v),B=L.getCompanyBlock(y),R=L.getTemplateBlocks(y);w.useEffect(()=>{if(a){d(L.getCompanyErrors(y)),r(L.getTemplateErrors(y));const j=L.getMajorUpdateNames(y,N).reduce((E,H)=>({...E,[H]:""}),{});l(j)}else m(""),l({}),f(!1)},[a]);const u=i.length>0||Object.values(c).flat().length>0,g=!u&&!p;return e.jsxs(ce,{blockScrollOnMount:!1,isOpen:a,onClose:n,scrollBehavior:"inside",children:[e.jsx(de,{}),e.jsxs(me,{children:[e.jsx(ue,{children:o("Submit templates")}),e.jsx(he,{}),u&&e.jsx(_e,{companyErrors:i,templateErrors:c,onClose:n}),g&&e.jsx(Ve,{justification:s,majorUpdateJustifications:h,onJustificationChange:m,onMajorUpdateJustificationChange:(j,E)=>l(H=>({...H,[j]:E})),onNext:()=>f(!0)}),!u&&p&&e.jsx(Ge,{companyName:I,companyBlock:B,templateBlocks:R,justification:s,majorUpdateJustifications:h,onPrev:()=>f(!1),onClose:n})]})]})}const De={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function Ke(){const{t}=b(),a=pe(),n=G(),[o,i]=w.useState(!1),d=()=>{F.isStandaloneWindow()?a("/"):F.openApp("rmg-templates")},c=()=>{n(Ee()),F.event(Ne.RESET_TICKETS,{})};return e.jsxs(fe,{sx:De,children:[e.jsxs(J,{children:[e.jsx(ze,{}),e.jsx(Ae,{})]}),e.jsxs(J,{children:[e.jsx(x,{size:"sm",onClick:d,children:t("Back to list")}),e.jsxs(U,{ml:"auto",children:[e.jsx(x,{size:"sm",variant:"outline",onClick:c,children:t("Reset")}),e.jsx(x,{size:"sm",colorScheme:"primary",onClick:()=>i(!0),children:t("Submit")})]})]}),e.jsx(We,{isOpen:o,onClose:()=>i(!1)})]})}export{Ke as default};
