System.register(["./chakra-legacy-DD_EbsbY.js","./index-legacy-TxJYQdvC.js","./react-legacy-MOpOoUDF.js","./use-templates-legacy-CQTWkuea.js"],(function(e,n){"use strict";var t,a,i,s,o,l,r,c,d,h,p,m,u,g,j,x,f,v,C,y,b,w,z,O,S,L,M,k,N,B,E,R,H,I,P,V,A,F,T,U,J,W,D,q,G,Y,$,Z,K,X,_,Q,ee,ne,te,ae,ie,se,oe,le,re,ce;return{setters:[e=>{t=e.a2,a=e.j,i=e.d,s=e.Z,o=e.E,l=e.a3,r=e.X,c=e.c,d=e.a4,h=e.a5,p=e.s,m=e.a6,u=e.r,g=e.a7,j=e.a8,x=e.t,f=e.v,v=e.a9,C=e.L,y=e.aa,b=e.M,w=e.ab,z=e.p,O=e.q,S=e.e},e=>{L=e.L,M=e.S,k=e.d,N=e.u,B=e.e,E=e.f,R=e.g,H=e.h,I=e.i,P=e.c,V=e.j,A=e.k,F=e.r,T=e.l,U=e.a,J=e.m,W=e.n,D=e.o,q=e.p,G=e.q,Y=e.t,$=e.v,Z=e.w,K=e.I,X=e.x,_=e.G,Q=e.y,ee=e.R,ne=e.z,te=e.E},e=>{ae=e.u,ie=e.r,se=e.p},e=>{oe=e.u,le=e.R,re=e.a,ce=e.b}],execute:function(){function n(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}}]})(e)}function de(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(e)}function he(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(e)}function pe(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(e)}function me(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(e)}function ue(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"}}]})(e)}function ge(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(e)}function je(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(e)}function xe(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(e)}function fe(e){const{optionalName:t,onChange:r}=e,{t:c}=ae(),d=oe(),h=(e,n)=>[{type:"select",label:c("Language"),value:e,options:Object.entries(L).reduce(((e,n)=>({...e,[n[0]]:d(n[1])})),{}),disabledOptions:Object.keys(L).filter((e=>M.includes(e)||t.some((n=>n[0]===e)))).filter((n=>n!==e)),onChange:n=>m(e,n)},{type:"input",label:c("Name"),value:n,onChange:n=>u(e,n),validator:e=>!!e}],p=()=>{const e=Object.keys(L).filter((e=>!M.includes(e)&&!t.some((n=>n[0]===e))));e.includes("ko")?r([...t,["ko",""]]):r([...t,[e[0],""]])},m=(e,n)=>{r(t.map((t=>t[0]===e?[n,t[1]]:t)))},u=(e,n)=>{r(t.map((t=>t[0]===e?[t[0],n]:t)))};return a.jsxs(a.Fragment,{children:[0===t.length&&a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(pe,{}),onClick:p,w:"100%",my:2,children:c("Add more translations")}),t.map((([e,i],d,m)=>a.jsxs(s,{sx:{w:"100%","& > div:first-of-type":{flex:1}},children:[a.jsx(le,{fields:h(e,i),noLabel:d>0}),d===m.length-1?a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Add translation"),title:c("Add translation"),onClick:p,icon:a.jsx(pe,{})}):a.jsx(l,{minW:8}),a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Remove this translation"),title:c("Remove this translation"),onClick:()=>(e=>{r(t.filter((n=>n[0]!==e)))})(e),icon:a.jsx(n,{})})]},e)))]})}function ve(){const{t:e}=ae(),n=oe(),t=k(),{company:i,newCompany:s,companyName:o,companyOptionalName:l}=N((e=>e.ticket)),d=re(),h=[{type:"select",label:e("Company"),value:i,options:{...d,[e("New")]:{new:e("Add a company...")}},disabledOptions:[""],onChange:e=>t(B(e))},{type:"input",label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:s,onChange:e=>t(E(e)),hidden:"new"!==i}],p=M.map((e=>({type:"input",label:n(L[e]),value:o[e],onChange:n=>t(R({lang:e,name:n}))})));return a.jsxs(H,{children:[a.jsx(I,{children:a.jsx(r,{as:"h5",size:"sm",children:e("Railway company")})}),a.jsx(c.div,{px:1,children:a.jsxs(P,{direction:"column",children:[a.jsx(le,{fields:h}),"new"===i&&a.jsx(le,{fields:p}),"new"===i&&a.jsx(fe,{optionalName:l,onChange:e=>t(V(e))})]})})]})}e("default",(function(){const{t:e}=ae(),n=se(),t=k(),[o,l]=ie.useState(!1);return a.jsxs(ee,{sx:Be,children:[a.jsxs(S,{children:[a.jsx(ve,{}),a.jsx(Se,{})]}),a.jsxs(S,{children:[a.jsx(i,{size:"sm",onClick:()=>{F.isStandaloneWindow()?n("/"):F.openApp("rmg-templates")},children:e("Back to list")}),a.jsxs(s,{ml:"auto",children:[a.jsx(i,{size:"sm",variant:"outline",onClick:()=>{t(ne()),F.event(te.RESET_TICKETS,{})},children:e("Reset")}),a.jsx(i,{size:"sm",colorScheme:"primary",onClick:()=>l(!0),children:e("Submit")})]})]}),a.jsx(Ne,{isOpen:o,onClose:()=>l(!1)})]})}));const Ce=e=>new Promise((n=>{const t=new FileReader;t.onloadend=()=>n(t.result),t.readAsText(e)})),ye={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function be(e){const{company:n,templateEntry:t,onLineChange:l,onNewLineChange:r,onMajorFlagChange:c,onLineNameChange:m,onOptionalNameChange:u,onParamChange:g,onParamImport:j,onRemove:x}=e,{line:f,newLine:v,majorUpdate:C,templateName:y,optionalName:b,param:w}=t,{t:z}=ae(),O=oe(),{templates:S}=ce(n),k=ie.useRef(null),N={"":z("Please select..."),...""===n||"new"===n?{}:S.reduce(((e,n)=>({...e,[n.filename]:O(n.name)})),{}),new:z("Add a line...")},B=[{type:"select",label:z("Line"),value:f,options:N,disabledOptions:[""],onChange:e=>l(e),minW:150},{type:"input",label:z("Line code"),placeholder:"e.g. twl, gz1, sh1",value:v,onChange:e=>r(e),hidden:"new"!==f},{type:"custom",label:z("Major update"),component:a.jsx(A,{selections:[{label:z("Yes"),value:!0},{label:z("No"),value:!1}],defaultValue:C,onChange:e=>c(e)}),hidden:"new"===f}],E=M.map((e=>({type:"input",label:O(L[e]),value:y[e],onChange:n=>m(e,n)})));return a.jsxs(P,{sx:ye,children:[a.jsx(o,{size:"sm",variant:"ghost",icon:a.jsx(xe,{}),"aria-label":z("Remove this line"),title:z("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:x}),a.jsxs(d,{spacing:0,children:[a.jsx(le,{fields:[...B,...E],minW:110}),a.jsx(fe,{optionalName:b,onChange:u})]}),a.jsx(d,{children:w?a.jsxs(a.Fragment,{children:[a.jsx(h,{as:ue,boxSize:10}),a.jsxs(p,{as:"i",fontSize:"xs",children:["(",z("Size"),": ",JSON.stringify(w).length," ",z("chars"),")"]}),a.jsx(i,{size:"sm",onClick:()=>g(void 0),children:z("Remove")})]}):a.jsxs(a.Fragment,{children:[a.jsx(p,{as:"i",fontSize:"sm",children:z("Import from")}),a.jsxs(s,{spacing:1,children:[a.jsx(i,{size:"sm",onClick:j,children:"RMG"}),a.jsx(i,{size:"sm",onClick:()=>{var e;return null===(e=k.current)||void 0===e?void 0:e.click()},children:z("Local")}),a.jsx("input",{ref:k,type:"file",accept:".json",onChange:async e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(console.log("handleFileUpload():: received file",t),t){if("application/json"!==t.type)return alert("Invalid file type!"),void(e.target.value="");try{const e=await Ce(t);g(JSON.parse(e))}catch(a){alert("Invalid file!"),e.target.value=""}}}})]})]})})]})}const we="rmg-bridge--",ze={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Oe(e){const{templateId:n,onClose:t,onImport:i}=e,[s]=ie.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:F.getAppName(),parentId:s});return ie.useEffect((()=>{const e=new BroadcastChannel(we+s);return e.onmessage=e=>{const{event:n,data:a}=e.data;console.log("[rmg-templates] Received event from RMG app clip:",n),"CLOSE"===n?t():"IMPORT"===n&&i(a)},()=>{e.close()}}),[n]),a.jsx(T,{isOpen:!!n,onClose:t,sx:ze,children:a.jsx("iframe",{src:o,loading:"lazy"})})}function Se(){const{t:e}=ae(),n=k(),{company:t,templates:o}=N((e=>e.ticket)),{templates:l,isLoading:d}=ce(t),[p,u]=ie.useState();return a.jsxs(H,{children:[d&&a.jsx(U,{isIndeterminate:!0}),a.jsxs(I,{children:[a.jsx(r,{as:"h5",size:"sm",children:e("Add or update templates")}),a.jsx(m,{hasArrow:!0,label:e("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:a.jsx("span",{children:a.jsx(h,{as:de,ml:1})})})]}),a.jsx(c.div,{px:1,transform:"translateZ(0)",children:o.map((e=>a.jsx(be,{company:t,templateEntry:e,onLineChange:t=>((e,t)=>{const a=l.find((e=>e.filename===t));n(Z({id:e,line:t,name:null==a?void 0:a.name}))})(e.id,t),onNewLineChange:t=>n(J({id:e.id,newLine:t})),onMajorFlagChange:t=>n(W({id:e.id,majorUpdate:t})),onLineNameChange:(t,a)=>n(D({id:e.id,lang:t,name:a})),onOptionalNameChange:t=>n(q({id:e.id,optionalName:t})),onParamChange:t=>n(G({id:e.id,param:t})),onParamImport:()=>u(e.id),onRemove:()=>n(Y(e.id))},e.id)))}),a.jsx(s,{justifyContent:"flex-end",children:a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(pe,{}),onClick:()=>n($()),children:e("Add item")})}),a.jsx(Oe,{templateId:p,onClose:()=>u(void 0),onImport:e=>{p&&n(G({id:p,param:e})),u(void 0)}})]})}function Le(e){const{companyErrors:n,templateErrors:t,onClose:o}=e,{t:l}=ae(),c=oe();return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(p,{children:l("Your inputs contain the following errors. Please fix it before submitting.")}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Railway company")}),a.jsx(g,{"aria-label":"List of company errors",children:n.map(((e,n)=>a.jsx(j,{children:c(K[e])},n)))})]}),Object.values(t).flat().length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Templates")}),a.jsx(g,{"aria-label":"List of template errors",children:Object.entries(t).map((([e,n])=>a.jsxs(j,{children:[e,a.jsx(g,{children:n.map(((e,n)=>a.jsx(j,{children:c(K[e])},n)))})]},e)))})]})]}),a.jsx(x,{children:a.jsx(s,{children:a.jsx(i,{colorScheme:"primary",onClick:o,children:l("Go back")})})})]})}function Me(e){const{haveBeenOpened:n,onHaveBeenOpenedChange:t,willBeOpened:s,onWillBeOpenedChange:o,refSource:l,onRefSourceChange:r,justification:c,majorUpdateJustifications:d,onJustificationChange:h,onMajorUpdateJustificationChange:m,onNext:g}=e,{t:j}=ae(),f=oe(),v=[{label:j("Yes"),value:!0},{label:j("No"),value:!1}],C=Object.fromEntries([["",j("Please select...")],...Object.entries(X).map((([e,n])=>[e,f(n)]))]),y=[{type:"custom",label:j("Have all of the lines been officially opened?"),component:a.jsx(A,{selections:v,defaultValue:n,onChange:t})},{type:"custom",label:j("Will they be opened soon? Are all of the station names finalised?"),component:a.jsx(A,{selections:v,defaultValue:s,onChange:o}),hidden:n},{type:"select",label:j("Reference source"),options:C,disabledOptions:[""],value:l,onChange:e=>r(e)},{type:"textarea",value:c,label:j("Justification"),placeholder:j("Briefly describe your changes and provide justification"),onChange:h}],b=Object.entries(d).map((([e,n])=>({type:"textarea",value:n,label:j("Justification for major update of")+" "+e,placeholder:j("Briefly describe your changes and provide justification"),onChange:n=>m(e,n)}))),w=!(n||s)||!l||!c||Object.values(d).some((e=>!e));return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(p,{children:j("Please provide suitable source and justification.")}),a.jsx(le,{fields:[...y,...b],minW:"full"})]}),a.jsx(x,{children:a.jsx(i,{colorScheme:"primary",onClick:g,rightIcon:a.jsx(je,{}),isDisabled:w,children:j("Next")})})]})}function ke(e){var n;const{companyName:t,companyBlock:s,templateBlocks:o,haveBeenOpened:l,willBeOpened:r,refSource:c,justification:d,majorUpdateJustifications:m,onPrev:g,onClose:y}=e,{t:b}=ae(),w=oe(),z=f("primary.500","primary.300"),O=["**Lines opening status:** "+(l?"OPENED":r?"WILL BE OPENED SOON":"NOT READY FOR OPENING"),`**Reference source:** ${c?w(X[c]):"(REPLACE ME)"}`,`**Justification:** ${d||"(REPLACE ME)"}`,Object.entries(m).map((([e,n])=>`- Major update of ${e}: ${n}`)).join("\n"),_,null!==(n=null==s?void 0:s.outerHTML)&&void 0!==n?n:"",...o.map((e=>e.outerHTML))].join("\n\n"),S=new URLSearchParams({template:"new-templates-request.md",labels:"resources",title:"Resources: New templates of "+t});return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(p,{children:b("Follow the instructions below to open an Issue")+":"}),a.jsxs(v,{children:[a.jsxs(j,{children:[b("Open")," ",a.jsxs(C,{color:z,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+S.toString(),isExternal:!0,children:["Issue: New Templates Request ",a.jsx(h,{as:he})]})]}),a.jsxs(j,{children:[b("Click copy button and paste into issue body")," ",a.jsx(i,{size:"xs",leftIcon:a.jsx(me,{}),onClick:async()=>{await navigator.clipboard.writeText(O)},children:b("Copy")})]})]})]}),a.jsxs(x,{children:[a.jsx(i,{variant:"ghost",onClick:g,mr:"auto",leftIcon:a.jsx(ge,{}),children:b("Previous")}),a.jsx(i,{colorScheme:"primary",onClick:y,children:b("Close")})]})]})}function Ne(e){const{isOpen:n,onClose:t}=e,{t:i}=ae(),[s,o]=ie.useState([]),[l,r]=ie.useState({}),[c,d]=ie.useState(!1),[h,p]=ie.useState(!1),[m,u]=ie.useState(""),[g,j]=ie.useState(""),[x,f]=ie.useState({}),[v,C]=ie.useState(!1),{coreCompanyConfig:S,otherCompanyConfig:L,templateList:M}=N((e=>e.app)),k=N((e=>e.ticket)),B=Q.getCompanyEnglishName(k,[...S,...L]),E=Q.getCompanyBlock(k),R=Q.getTemplateBlocks(k);ie.useEffect((()=>{if(n){o(Q.getCompanyErrors(k)),r(Q.getTemplateErrors(k));const e=Q.getMajorUpdateNames(k,M).reduce(((e,n)=>({...e,[n]:""})),{});f(e)}else d(!1),p(!1),u(""),j(""),f({}),C(!1)}),[n]);const H=s.length>0||Object.values(l).flat().length>0,I=!H&&!v;return a.jsxs(y,{blockScrollOnMount:!1,isOpen:n,onClose:t,scrollBehavior:"inside",children:[a.jsx(b,{}),a.jsxs(w,{children:[a.jsx(z,{children:i("Submit templates")}),a.jsx(O,{}),H&&a.jsx(Le,{companyErrors:s,templateErrors:l,onClose:t}),I&&a.jsx(Me,{haveBeenOpened:c,onHaveBeenOpenedChange:d,willBeOpened:h,onWillBeOpenedChange:p,refSource:m,onRefSourceChange:u,justification:g,majorUpdateJustifications:x,onJustificationChange:j,onMajorUpdateJustificationChange:(e,n)=>f((t=>({...t,[e]:n}))),onNext:()=>C(!0)}),!H&&v&&a.jsx(ke,{companyName:B,companyBlock:E,templateBlocks:R,haveBeenOpened:c,willBeOpened:h,refSource:m,justification:g,majorUpdateJustifications:x,onPrev:()=>C(!1),onClose:t})]})]})}const Be={width:{base:"100%",md:520},alignSelf:"center","& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto",bg:"inherit"},"& > div:nth-of-type(2)":{my:2}}}}}));
