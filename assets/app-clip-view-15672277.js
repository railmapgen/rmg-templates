import{j as t,t as $,v as O,X as w,Y as M,r as j}from"./chakra-4d1cedbe.js";import{u as b,r as d,R as k,a as D}from"./index-ef7f4532.js";import{P as V,T as z}from"./templates-grid-a1d4b6ae.js";import{u as H,k as W,r as o}from"./react-d5c86316.js";import{u as B,E as u}from"./use-templates-2873cdfc.js";const F="rmg-templates-bridge--";function J(){const{t:i}=H(),f=B(),[C]=W(),y=C.get("parentId"),r=C.get("parentComponent"),{selectedCompany:a,coreCompanyConfig:v,otherCompanyConfig:R}=b(e=>e.app),[c,m]=o.useState(),[S,g]=o.useState(!1),[_,h]=o.useState(!1),s=o.useRef();o.useEffect(()=>{var n;s.current=new BroadcastChannel(F+y),d.event(u.APP_CLIP_VIEW_OPENED,{parentComponent:r}),console.log(`[${(n=s.current)==null?void 0:n.name}] App clip connection established, parentComponent=${r}`);const e=document.createElement("style");return e.textContent=".rmg-window__header{margin-left: unset;}",document.head.appendChild(e),()=>{var l;(l=s.current)==null||l.close(),document.head.removeChild(e)}},[]),o.useEffect(()=>{m(void 0)},[a]);const L=async()=>{var E,P,x,I;if(!c)return;const{filename:e,name:n}=c;console.log(`[${(E=s.current)==null?void 0:E.name}] Emitting IMPORT event, company=${a}, template=${e}`);const l=(x=(P=[...v,...R].find(p=>p.id===a))==null?void 0:P.name)!=null?x:{},A=f(l)+" "+f(n);try{g(!0);const N=await(await fetch(`/rmg-templates/resources/templates/${a}/${e}.json`)).json();(I=s.current)==null||I.postMessage({event:"IMPORT",meta:{company:a,filename:e,name:A},data:N}),d.event(u.APP_CLIP_VIEW_IMPORT,{parentComponent:r,company:a,filename:e})}catch(p){h(!0)}finally{g(!1),m(void 0)}},T=()=>{var e,n;console.log(`[${(e=s.current)==null?void 0:e.name}] Emitting CLOSE event`),(n=s.current)==null||n.postMessage({event:"CLOSE"}),d.event(u.APP_CLIP_VIEW_CLOSED,{parentComponent:r}),m(void 0),h(!1)};return t.jsxs(t.Fragment,{children:[t.jsxs(k,{children:[S&&t.jsx(D,{isIndeterminate:!0}),_&&t.jsxs($,{status:"error",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[t.jsx(O,{}),i("Unable to import selected template.")]}),t.jsx(V,{}),t.jsx(z,{selectedTemplate:c,onTemplateSelect:m})]}),t.jsx(w,{}),t.jsxs(M,{p:2,justifyContent:"flex-end",children:[t.jsx(j,{size:"sm",onClick:T,children:i("Close")}),t.jsx(j,{size:"sm",colorScheme:"primary",isDisabled:!c,onClick:L,children:i("Import")})]})]})}export{J as default};
