System.register(["./chakra-legacy-DD_EbsbY.js","./index-legacy-OKzd0xLE.js","./react-legacy-MOpOoUDF.js","./use-templates-legacy-MwtYF6U3.js"],(function(e,t){"use strict";var n,a,i,s,o,l,r,c,d,h,m,p,u,j,g,x,f,v,y,C,b,w,z,k,M,L,S,N,O,H,I,R,E,B,P,U,V,F,J,T,A,W,q,G,D,Y,$,Z,K,X,_,Q,ee,te,ne,ae,ie,se,oe,le,re;return{setters:[e=>{n=e.a2,a=e.j,i=e.d,s=e.Z,o=e.E,l=e.a3,r=e.X,c=e.c,d=e.a4,h=e.a5,m=e.s,p=e.a6,u=e.r,j=e.a7,g=e.a8,x=e.t,f=e.v,v=e.a9,y=e.L,C=e.aa,b=e.M,w=e.ab,z=e.p,k=e.q,M=e.e},e=>{L=e.L,S=e.S,N=e.d,O=e.u,H=e.e,I=e.f,R=e.g,E=e.h,B=e.i,P=e.c,U=e.j,V=e.k,F=e.r,J=e.l,T=e.a,A=e.m,W=e.n,q=e.o,G=e.p,D=e.q,Y=e.t,$=e.v,Z=e.w,K=e.I,X=e.G,_=e.x,Q=e.R,ee=e.y,te=e.E},e=>{ne=e.u,ae=e.r,ie=e.p},e=>{se=e.u,oe=e.R,le=e.a,re=e.b}],execute:function(){function t(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}}]})(e)}function ce(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(e)}function de(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(e)}function he(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(e)}function me(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(e)}function pe(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"}}]})(e)}function ue(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(e)}function je(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(e)}function ge(e){return n({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(e)}function xe(e){const{optionalName:n,onChange:r}=e,{t:c}=ne(),d=se(),h=(e,t)=>[{type:"select",label:c("Language"),value:e,options:Object.entries(L).reduce(((e,t)=>({...e,[t[0]]:d(t[1])})),{}),disabledOptions:Object.keys(L).filter((e=>S.includes(e)||n.some((t=>t[0]===e)))).filter((t=>t!==e)),onChange:t=>p(e,t)},{type:"input",label:c("Name"),value:t,onChange:t=>u(e,t),validator:e=>!!e}],m=()=>{const e=Object.keys(L).filter((e=>!S.includes(e)&&!n.some((t=>t[0]===e))));e.includes("ko")?r([...n,["ko",""]]):r([...n,[e[0],""]])},p=(e,t)=>{r(n.map((n=>n[0]===e?[t,n[1]]:n)))},u=(e,t)=>{r(n.map((n=>n[0]===e?[n[0],t]:n)))};return a.jsxs(a.Fragment,{children:[0===n.length&&a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(he,{}),onClick:m,w:"100%",my:2,children:c("Add more translations")}),n.map((([e,i],d,p)=>a.jsxs(s,{sx:{w:"100%","& > div:first-of-type":{flex:1}},children:[a.jsx(oe,{fields:h(e,i),noLabel:d>0}),d===p.length-1?a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Add translation"),title:c("Add translation"),onClick:m,icon:a.jsx(he,{})}):a.jsx(l,{minW:8}),a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Remove this translation"),title:c("Remove this translation"),onClick:()=>(e=>{r(n.filter((t=>t[0]!==e)))})(e),icon:a.jsx(t,{})})]},e)))]})}function fe(){const{t:e}=ne(),t=se(),n=N(),{company:i,newCompany:s,companyName:o,companyOptionalName:l}=O((e=>e.ticket)),d=le(),h=[{type:"select",label:e("Company"),value:i,options:{...d,[e("New")]:{new:e("Add a company...")}},disabledOptions:[""],onChange:e=>n(H(e))},{type:"input",label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:s,onChange:e=>n(I(e)),hidden:"new"!==i}],m=S.map((e=>({type:"input",label:t(L[e]),value:o[e],onChange:t=>n(R({lang:e,name:t}))})));return a.jsxs(E,{children:[a.jsx(B,{children:a.jsx(r,{as:"h5",size:"sm",children:e("Railway company")})}),a.jsx(c.div,{px:1,children:a.jsxs(P,{direction:"column",children:[a.jsx(oe,{fields:h}),"new"===i&&a.jsx(oe,{fields:m}),"new"===i&&a.jsx(xe,{optionalName:l,onChange:e=>n(U(e))})]})})]})}e("default",(function(){const{t:e}=ne(),t=ie(),n=N(),[o,l]=ae.useState(!1);return a.jsxs(Q,{sx:Oe,children:[a.jsxs(M,{children:[a.jsx(fe,{}),a.jsx(ke,{})]}),a.jsxs(M,{children:[a.jsx(i,{size:"sm",onClick:()=>{F.isStandaloneWindow()?t("/"):F.openApp("rmg-templates")},children:e("Back to list")}),a.jsxs(s,{ml:"auto",children:[a.jsx(i,{size:"sm",variant:"outline",onClick:()=>{n(ee()),F.event(te.RESET_TICKETS,{})},children:e("Reset")}),a.jsx(i,{size:"sm",colorScheme:"primary",onClick:()=>l(!0),children:e("Submit")})]})]}),a.jsx(Ne,{isOpen:o,onClose:()=>l(!1)})]})}));const ve=e=>new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsText(e)})),ye={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function Ce(e){const{company:t,templateEntry:n,onLineChange:l,onNewLineChange:r,onMajorFlagChange:c,onLineNameChange:p,onOptionalNameChange:u,onParamChange:j,onParamImport:g,onRemove:x}=e,{line:f,newLine:v,majorUpdate:y,templateName:C,optionalName:b,param:w}=n,{t:z}=ne(),k=se(),{templates:M}=re(t),N=ae.useRef(null),O={"":z("Please select..."),...""===t||"new"===t?{}:M.reduce(((e,t)=>({...e,[t.filename]:k(t.name)})),{}),new:z("Add a line...")},H=[{type:"select",label:z("Line"),value:f,options:O,disabledOptions:[""],onChange:e=>l(e),minW:150},{type:"input",label:z("Line code"),placeholder:"e.g. twl, gz1, sh1",value:v,onChange:e=>r(e),hidden:"new"!==f},{type:"custom",label:z("Major update"),component:a.jsx(V,{selections:[{label:z("Yes"),value:!0},{label:z("No"),value:!1}],defaultValue:y,onChange:e=>c(e)}),hidden:"new"===f}],I=S.map((e=>({type:"input",label:k(L[e]),value:C[e],onChange:t=>p(e,t)})));return a.jsxs(P,{sx:ye,children:[a.jsx(o,{size:"sm",variant:"ghost",icon:a.jsx(ge,{}),"aria-label":z("Remove this line"),title:z("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:x}),a.jsxs(d,{spacing:0,children:[a.jsx(oe,{fields:[...H,...I],minW:110}),a.jsx(xe,{optionalName:b,onChange:u})]}),a.jsx(d,{children:w?a.jsxs(a.Fragment,{children:[a.jsx(h,{as:pe,boxSize:10}),a.jsxs(m,{as:"i",fontSize:"xs",children:["(",z("Size"),": ",JSON.stringify(w).length," ",z("chars"),")"]}),a.jsx(i,{size:"sm",onClick:()=>j(void 0),children:z("Remove")})]}):a.jsxs(a.Fragment,{children:[a.jsx(m,{as:"i",fontSize:"sm",children:z("Import from")}),a.jsxs(s,{spacing:1,children:[a.jsx(i,{size:"sm",onClick:g,children:"RMG"}),a.jsx(i,{size:"sm",onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},children:z("Local")}),a.jsx("input",{ref:N,type:"file",accept:".json",onChange:async e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(console.log("handleFileUpload():: received file",n),n){if("application/json"!==n.type)return alert("Invalid file type!"),void(e.target.value="");try{const e=await ve(n);j(JSON.parse(e))}catch(a){alert("Invalid file!"),e.target.value=""}}}})]})]})})]})}const be="rmg-bridge--",we={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function ze(e){const{templateId:t,onClose:n,onImport:i}=e,[s]=ae.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:F.getAppName(),parentId:s});return ae.useEffect((()=>{const e=new BroadcastChannel(be+s);return e.onmessage=e=>{const{event:t,data:a}=e.data;console.log("[rmg-templates] Received event from RMG app clip:",t),"CLOSE"===t?n():"IMPORT"===t&&i(a)},()=>{e.close()}}),[t]),a.jsx(J,{isOpen:!!t,onClose:n,sx:we,children:a.jsx("iframe",{src:o,loading:"lazy"})})}function ke(){const{t:e}=ne(),t=N(),{company:n,templates:o}=O((e=>e.ticket)),{templates:l,isLoading:d}=re(n),[m,u]=ae.useState();return a.jsxs(E,{children:[d&&a.jsx(T,{isIndeterminate:!0}),a.jsxs(B,{children:[a.jsx(r,{as:"h5",size:"sm",children:e("Add or update templates")}),a.jsx(p,{hasArrow:!0,label:e("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:a.jsx("span",{children:a.jsx(h,{as:ce,ml:1})})})]}),a.jsx(c.div,{px:1,transform:"translateZ(0)",children:o.map((e=>a.jsx(Ce,{company:n,templateEntry:e,onLineChange:n=>((e,n)=>{const a=l.find((e=>e.filename===n));t(Z({id:e,line:n,name:null==a?void 0:a.name}))})(e.id,n),onNewLineChange:n=>t(A({id:e.id,newLine:n})),onMajorFlagChange:n=>t(W({id:e.id,majorUpdate:n})),onLineNameChange:(n,a)=>t(q({id:e.id,lang:n,name:a})),onOptionalNameChange:n=>t(G({id:e.id,optionalName:n})),onParamChange:n=>t(D({id:e.id,param:n})),onParamImport:()=>u(e.id),onRemove:()=>t(Y(e.id))},e.id)))}),a.jsx(s,{justifyContent:"flex-end",children:a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(he,{}),onClick:()=>t($()),children:e("Add item")})}),a.jsx(ze,{templateId:m,onClose:()=>u(void 0),onImport:e=>{m&&t(D({id:m,param:e})),u(void 0)}})]})}function Me(e){const{companyErrors:t,templateErrors:n,onClose:o}=e,{t:l}=ne(),c=se();return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(m,{children:l("Your inputs contain the following errors. Please fix it before submitting.")}),t.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Railway company")}),a.jsx(j,{"aria-label":"List of company errors",children:t.map(((e,t)=>a.jsx(g,{children:c(K[e])},t)))})]}),Object.values(n).flat().length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Templates")}),a.jsx(j,{"aria-label":"List of template errors",children:Object.entries(n).map((([e,t])=>a.jsxs(g,{children:[e,a.jsx(j,{children:t.map(((e,t)=>a.jsx(g,{children:c(K[e])},t)))})]},e)))})]})]}),a.jsx(x,{children:a.jsx(s,{children:a.jsx(i,{colorScheme:"primary",onClick:o,children:l("Go back")})})})]})}function Le(e){const{justification:t,majorUpdateJustifications:n,onJustificationChange:s,onMajorUpdateJustificationChange:o,onNext:l}=e,{t:r}=ne(),c=[{type:"textarea",value:t,label:r("Justification"),placeholder:r("Briefly describe your changes and provide justification"),onChange:s}],d=Object.entries(n).map((([e,t])=>({type:"textarea",value:t,label:r("Justification for major update of")+" "+e,placeholder:r("Briefly describe your changes and provide justification"),onChange:t=>o(e,t)}))),h=!t||Object.values(n).some((e=>!e));return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(m,{children:r("Please provide suitable source and justification.")}),a.jsx(oe,{fields:[...c,...d],minW:"full"})]}),a.jsx(x,{children:a.jsx(i,{colorScheme:"primary",onClick:l,rightIcon:a.jsx(je,{}),isDisabled:h,children:r("Next")})})]})}function Se(e){var t;const{companyName:n,companyBlock:s,templateBlocks:o,justification:l,majorUpdateJustifications:r,onPrev:c,onClose:d}=e,{t:p}=ne(),j=f("primary.500","primary.300"),C=[`**Justification:** ${l||"(REPLACE ME)"}`,Object.entries(r).map((([e,t])=>`- Major update of ${e}: ${t}`)).join("\n"),X,null!==(t=null==s?void 0:s.outerHTML)&&void 0!==t?t:"",...o.map((e=>e.outerHTML))].join("\n\n"),b=new URLSearchParams({template:"new-templates-request.md",labels:"resources",title:"Resources: New templates of "+n});return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(m,{children:p("Follow the instructions below to open an Issue")+":"}),a.jsxs(v,{children:[a.jsxs(g,{children:[p("Open")," ",a.jsxs(y,{color:j,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+b.toString(),isExternal:!0,children:["Issue: New Templates Request ",a.jsx(h,{as:de})]})]}),a.jsxs(g,{children:[p("Click copy button and paste into issue body")," ",a.jsx(i,{size:"xs",leftIcon:a.jsx(me,{}),onClick:async()=>{await navigator.clipboard.writeText(C)},children:p("Copy")})]})]})]}),a.jsxs(x,{children:[a.jsx(i,{variant:"ghost",onClick:c,mr:"auto",leftIcon:a.jsx(ue,{}),children:p("Previous")}),a.jsx(i,{colorScheme:"primary",onClick:d,children:p("Close")})]})]})}function Ne(e){const{isOpen:t,onClose:n}=e,{t:i}=ne(),[s,o]=ae.useState([]),[l,r]=ae.useState({}),[c,d]=ae.useState(""),[h,m]=ae.useState({}),[p,u]=ae.useState(!1),{coreCompanyConfig:j,otherCompanyConfig:g,templateList:x}=O((e=>e.app)),f=O((e=>e.ticket)),v=_.getCompanyEnglishName(f,[...j,...g]),y=_.getCompanyBlock(f),M=_.getTemplateBlocks(f);ae.useEffect((()=>{if(t){o(_.getCompanyErrors(f)),r(_.getTemplateErrors(f));const e=_.getMajorUpdateNames(f,x).reduce(((e,t)=>({...e,[t]:""})),{});m(e)}else d(""),m({}),u(!1)}),[t]);const L=s.length>0||Object.values(l).flat().length>0,S=!L&&!p;return a.jsxs(C,{blockScrollOnMount:!1,isOpen:t,onClose:n,scrollBehavior:"inside",children:[a.jsx(b,{}),a.jsxs(w,{children:[a.jsx(z,{children:i("Submit templates")}),a.jsx(k,{}),L&&a.jsx(Me,{companyErrors:s,templateErrors:l,onClose:n}),S&&a.jsx(Le,{justification:c,majorUpdateJustifications:h,onJustificationChange:d,onMajorUpdateJustificationChange:(e,t)=>m((n=>({...n,[e]:t}))),onNext:()=>u(!0)}),!L&&p&&a.jsx(Se,{companyName:v,companyBlock:y,templateBlocks:M,justification:c,majorUpdateJustifications:h,onPrev:()=>u(!1),onClose:n})]})]})}const Oe={width:{base:"100%",md:520},alignSelf:"center","& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto",bg:"inherit"},"& > div:nth-of-type(2)":{my:2}}}}}));
