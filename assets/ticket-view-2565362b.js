import{u as S,S as Y,O as K,j as d,Q,a as t,H as I,U as X,y as B,V as x,W as ae,X as ne,Y as J,Z as oe,_ as Z,z as F,A as C,$ as T,a0 as _,a1 as V,a2 as A,a3 as k,a4 as G,a5 as ie,a6 as se,a7 as re,c as j,a8 as le,a9 as ce,aa as de,ab as me,ac as he,w as ue,N as pe,r as fe}from"./vendor-f64b48da.js";import{a as D,u as z,b as ge,c as ve,d as ye,e as Ce,f as be,g as we,h as Me,r as Se,i as je,j as xe,t as L,k as ze}from"./index-586b4374.js";import{u as W,I as $,G as Ee,E as Ne}from"./constant-fb6d3be3.js";function Le(){const{t:e,i18n:a}=S(),n=W(),i=D(),{companyConfig:s}=z(c=>c.app),{company:h,newCompany:o,companyName:r}=z(c=>c.ticket),l={...s.map(c=>[c.id,n(c.name)]).sort((c,f)=>c[1].localeCompare(f[1],a.languages[0])).reduce((c,f)=>({...c,[f[0]]:f[1]}),{"":e("Please select...")}),new:e("Add a company...")},u=[{type:"select",label:e("Company"),value:h,options:l,disabledOptions:[""],onChange:c=>i(ge(c))},{type:"input",label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:o,onChange:c=>i(ve(c)),hidden:h!=="new"}],p=Y.map(c=>({type:"input",label:n(K[c]),value:r[c],onChange:f=>i(ye({lang:c,name:f}))}));return d(Q,{as:"section",children:[t(I,{as:"h5",size:"sm",mb:2,children:e("Railway company")}),d(X,{direction:"column",children:[t(B,{fields:u}),h==="new"&&t(B,{fields:p})]})]})}const Oe=e=>new Promise(a=>{const n=new FileReader;n.onloadend=()=>a(n.result),n.readAsText(e)});var ee={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},q=x.createContext&&x.createContext(ee),M=globalThis&&globalThis.__assign||function(){return M=Object.assign||function(e){for(var a,n=1,i=arguments.length;n<i;n++){a=arguments[n];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e},M.apply(this,arguments)},Te=globalThis&&globalThis.__rest||function(e,a){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&a.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)a.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n};function te(e){return e&&e.map(function(a,n){return x.createElement(a.tag,M({key:n},a.attr),te(a.child))})}function E(e){return function(a){return x.createElement(ke,M({attr:M({},e.attr)},a),te(e.child))}}function ke(e){var a=function(n){var i=e.attr,s=e.size,h=e.title,o=Te(e,["attr","size","title"]),r=s||n.size||"1em",l;return n.className&&(l=n.className),e.className&&(l=(l?l+" ":"")+e.className),x.createElement("svg",M({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,i,o,{className:l,style:M(M({color:e.color||n.color},n.style),e.style),height:r,width:r,xmlns:"http://www.w3.org/2000/svg"}),h&&x.createElement("title",null,h),e.children)};return q!==void 0?x.createElement(q.Consumer,null,function(n){return a(n)}):a(ee)}function Ie(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(e)}function Be(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(e)}function Re(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(e)}function He(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(e)}function Pe(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(e)}function Ue(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(e)}function Ae(e){return E({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(e)}function Je(e){const{company:a,templateEntry:n,onLineChange:i,onNewLineChange:s,onMajorFlagChange:h,onLineNameChange:o,onParamChange:r,onRemove:l}=e,{line:u,newLine:p,majorUpdate:c,templateName:f}=n,{t:g}=S(),b=W(),{templateList:O}=z(m=>m.app),w=async m=>{var y;const v=(y=m.target.files)==null?void 0:y[0];if(console.log("handleFileUpload():: received file",v),!!v){if(v.type!=="application/json"){alert("Invalid file type!"),m.target.value="";return}try{const N=await Oe(v);r(JSON.parse(N))}catch(N){alert("Invalid file!"),m.target.value=""}}},R={"":g("Please select..."),...a===""||a==="new"?{}:O[a].reduce((m,v)=>({...m,[v.filename]:b(v.name)}),{}),new:g("Add a line...")},H=[{type:"select",label:g("Line"),value:u,options:R,disabledOptions:[""],onChange:m=>i(m),minW:150},{type:"custom",label:g("Configuration file"),component:t(ae,{variant:"flushed",size:"xs",type:"file",accept:".json",onChange:w}),minW:250},{type:"input",label:g("Line code"),placeholder:"e.g. twl, gz1, sh1",value:p,onChange:m=>s(m),hidden:u!=="new"},{type:"switch",label:g("Major update"),isChecked:c,onChange:m=>h(m),hidden:u==="new",oneLine:!0}],P=Y.map(m=>({type:"input",label:b(K[m]),value:f[m],onChange:v=>o(m,v),minW:m==="en"?260:void 0}));return d(X,{position:"relative",direction:"column",children:[t(ne,{size:"sm",variant:"ghost",icon:t(Ae,{}),"aria-label":g("Remove this line"),title:g("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:l}),t(B,{fields:[...H,...P],minW:110})]})}function Fe(){const{t:e}=S(),a=D(),{templateList:n}=z(o=>o.app),{company:i,templates:s}=z(o=>o.ticket),h=(o,r)=>{var u;const l=(u=n[i])==null?void 0:u.find(p=>p.filename===r);a(xe({id:o,line:r,name:l==null?void 0:l.name}))};return d(Q,{as:"section",mt:3,children:[d(J,{children:[t(I,{as:"h5",size:"sm",mb:2,children:e("Add or update templates")}),t(oe,{hasArrow:!0,label:e("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:t("span",{children:t(Z,{as:Ie,ml:1})})})]}),s.map(o=>t(Je,{company:i,templateEntry:o,onLineChange:r=>h(o.id,r),onNewLineChange:r=>a(Ce({id:o.id,newLine:r})),onMajorFlagChange:r=>a(be({id:o.id,majorUpdate:r})),onLineNameChange:(r,l)=>a(we({id:o.id,lang:r,name:l})),onParamChange:r=>a(Me({id:o.id,param:r})),onRemove:()=>a(Se(o.id))},o.id)),t(F,{justifyContent:"flex-end",children:t(C,{variant:"ghost",size:"sm",leftIcon:t(Re,{}),onClick:()=>a(je()),children:e("Add item")})})]})}function _e(e){const{companyErrors:a,templateErrors:n,onClose:i}=e,{t:s}=S(),h=W();return d(T,{children:[d(_,{children:[t(V,{children:s("Your inputs contain the following errors. Please fix it before submitting.")}),a.length>0&&d(T,{children:[t(I,{as:"h5",size:"sm",my:2,children:s("Railway company")}),t(A,{"aria-label":"List of company errors",children:a.map((o,r)=>t(k,{children:h($[o])},r))})]}),Object.values(n).flat().length>0&&d(T,{children:[t(I,{as:"h5",size:"sm",my:2,children:s("Templates")}),t(A,{"aria-label":"List of template errors",children:Object.entries(n).map(([o,r])=>d(k,{children:[o,t(A,{children:r.map((l,u)=>t(k,{children:h($[l])},u))})]},o))})]})]}),t(G,{children:t(F,{children:t(C,{colorScheme:"primary",onClick:i,children:s("Go back")})})})]})}function Ve(e){const{justification:a,majorUpdateJustifications:n,onJustificationChange:i,onMajorUpdateJustificationChange:s,onNext:h}=e,{t:o}=S(),r=[{type:"textarea",value:a,label:o("Justification"),placeholder:o("Briefly describe your changes and provide justification"),onChange:i}],l=Object.entries(n).map(([p,c])=>({type:"textarea",value:c,label:o("Justification for major update of")+" "+p,placeholder:o("Briefly describe your changes and provide justification"),onChange:f=>s(p,f)})),u=!a||Object.values(n).some(p=>!p);return d(T,{children:[d(_,{children:[t(V,{children:o("Please provide suitable source and justification.")}),t(B,{fields:[...r,...l],minW:"full"})]}),t(G,{children:t(C,{colorScheme:"primary",onClick:h,rightIcon:t(Ue,{}),isDisabled:u,children:o("Next")})})]})}function Ge(e){var g;const{companyName:a,companyBlock:n,templateBlocks:i,justification:s,majorUpdateJustifications:h,onPrev:o,onClose:r}=e,{t:l}=S(),u=ie("primary.500","primary.300"),p=[`**Justification:** ${s||"(REPLACE ME)"}`,Object.entries(h).map(([b,O])=>`- Major update of ${b}: ${O}`).join(`
`),Ee,(g=n==null?void 0:n.outerHTML)!=null?g:"",...i.map(b=>b.outerHTML)].join(`

`),c=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+a}),f=async()=>{await navigator.clipboard.writeText(p)};return d(T,{children:[d(_,{children:[t(V,{children:l("Follow the instructions below to open an Issue")+":"}),d(se,{children:[d(k,{children:[l("Open")," ",d(re,{color:u,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+c.toString(),isExternal:!0,children:["Issue: New Templates Request ",t(Z,{as:Be})]})]}),d(k,{children:[l("Click copy button and paste into issue body")," ",t(C,{size:"xs",leftIcon:t(He,{}),onClick:f,children:l("Copy")})]})]})]}),d(G,{children:[t(C,{variant:"ghost",onClick:o,mr:"auto",leftIcon:t(Pe,{}),children:l("Previous")}),t(C,{colorScheme:"primary",onClick:r,children:l("Close")})]})]})}function De(e){const{isOpen:a,onClose:n}=e,{t:i}=S(),[s,h]=j.useState([]),[o,r]=j.useState({}),[l,u]=j.useState(""),[p,c]=j.useState({}),[f,g]=j.useState(!1),{companyConfig:b,templateList:O}=z(y=>y.app),w=z(y=>y.ticket),R=L.getCompanyEnglishName(w,b),H=L.getCompanyBlock(w),P=L.getTemplateBlocks(w);j.useEffect(()=>{if(a){h(L.getCompanyErrors(w)),r(L.getTemplateErrors(w));const y=L.getMajorUpdateNames(w,O).reduce((N,U)=>({...N,[U]:""}),{});c(y)}else u(""),c({}),g(!1)},[a]);const m=s.length>0||Object.values(o).flat().length>0,v=!m&&!f;return d(le,{blockScrollOnMount:!1,isOpen:a,onClose:n,scrollBehavior:"inside",children:[t(ce,{}),d(de,{children:[t(me,{children:i("Submit templates")}),t(he,{}),m&&t(_e,{companyErrors:s,templateErrors:o,onClose:n}),v&&t(Ve,{justification:l,majorUpdateJustifications:p,onJustificationChange:u,onMajorUpdateJustificationChange:(y,N)=>c(U=>({...U,[y]:N})),onNext:()=>g(!0)}),!m&&f&&t(Ge,{companyName:R,companyBlock:H,templateBlocks:P,justification:l,majorUpdateJustifications:p,onPrev:()=>g(!1),onClose:n})]})]})}const We={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function Ke(){const{t:e}=S(),a=ue(),n=D(),[i,s]=j.useState(!1),h=()=>{n(ze()),fe.event(Ne.RESET_TICKETS,{})};return d(pe,{sx:We,children:[d(J,{children:[t(Le,{}),t(Fe,{})]}),d(J,{children:[t(C,{size:"sm",onClick:()=>a("/"),children:e("Go back")}),d(F,{ml:"auto",children:[t(C,{size:"sm",variant:"outline",onClick:h,children:e("Reset")}),t(C,{size:"sm",colorScheme:"primary",onClick:()=>s(!0),children:e("Submit")})]})]}),t(De,{isOpen:i,onClose:()=>s(!1)})]})}export{Ke as default};
