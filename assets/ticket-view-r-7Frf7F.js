import{a2 as N,j as e,d as v,Z as F,E as X,a3 as fe,X as D,c as le,a4 as ne,a5 as Q,s as H,a6 as ge,r as ee,a7 as q,a8 as T,t as te,v as je,a9 as xe,L as ve,aa as Ce,M as ye,ab as be,p as Se,q as Oe,e as se}from"./chakra-zRGELh8M.js";import{L as A,S as G,d as ae,u as _,e as Ne,f as Le,g as Me,h as re,i as ce,c as de,j as we,k as Z,r as J,l as Re,a as ke,m as Ee,n as Ie,o as ze,p as Be,q as oe,t as Te,v as Ae,w as He,I as ie,x as pe,G as Pe,y as I,R as Fe,z as Ue,E as Ve}from"./index-L3ZtpQR6.js";import{u as L,r as x,p as Je}from"./react-3B37V2lT.js";import{u as z,R as P,a as De,b as me}from"./use-templates-kkD9OydW.js";function Ge(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}}]})(a)}function _e(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(a)}function We(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(a)}function K(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(a)}function $e(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(a)}function Ye(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"}}]})(a)}function qe(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(a)}function Xe(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(a)}function Ze(a){return N({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(a)}function he(a){const{optionalName:n,onChange:i}=a,{t:l}=L(),d=z(),p=(t,o)=>[{type:"select",label:l("Language"),value:t,options:Object.entries(A).reduce((s,j)=>({...s,[j[0]]:d(j[1])}),{}),disabledOptions:Object.keys(A).filter(s=>G.includes(s)||n.some(j=>j[0]===s)).filter(s=>s!==t),onChange:s=>m(t,s)},{type:"input",label:l("Name"),value:o,onChange:s=>h(t,s),validator:s=>!!s}],c=()=>{const t=Object.keys(A).filter(o=>!G.includes(o)&&!n.some(s=>s[0]===o));t.includes("ko")?i([...n,["ko",""]]):i([...n,[t[0],""]])},m=(t,o)=>{i(n.map(s=>s[0]===t?[o,s[1]]:s))},h=(t,o)=>{i(n.map(s=>s[0]===t?[s[0],o]:s))},g=t=>{i(n.filter(o=>o[0]!==t))};return e.jsxs(e.Fragment,{children:[n.length===0&&e.jsx(v,{variant:"ghost",size:"sm",leftIcon:e.jsx(K,{}),onClick:c,w:"100%",my:2,children:l("Add more translations")}),n.map(([t,o],s,j)=>e.jsxs(F,{sx:{w:"100%","& > div:first-of-type":{flex:1}},children:[e.jsx(P,{fields:p(t,o),noLabel:s>0}),s===j.length-1?e.jsx(X,{size:"sm",variant:"ghost","aria-label":l("Add translation"),title:l("Add translation"),onClick:c,icon:e.jsx(K,{})}):e.jsx(fe,{minW:8}),e.jsx(X,{size:"sm",variant:"ghost","aria-label":l("Remove this translation"),title:l("Remove this translation"),onClick:()=>g(t),icon:e.jsx(Ge,{})})]},t))]})}function Ke(){const{t:a}=L(),n=z(),i=ae(),{company:l,newCompany:d,companyName:p,companyOptionalName:c}=_(t=>t.ticket),m=De(),h=[{type:"select",label:a("Company"),value:l,options:{...m,[a("New")]:{new:a("Add a company...")}},disabledOptions:[""],onChange:t=>i(Ne(t))},{type:"input",label:a("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:d,onChange:t=>i(Le(t)),hidden:l!=="new"}],g=G.map(t=>({type:"input",label:n(A[t]),value:p[t],onChange:o=>i(Me({lang:t,name:o}))}));return e.jsxs(re,{children:[e.jsx(ce,{children:e.jsx(D,{as:"h5",size:"sm",children:a("Railway company")})}),e.jsx(le.div,{px:1,children:e.jsxs(de,{direction:"column",children:[e.jsx(P,{fields:h}),l==="new"&&e.jsx(P,{fields:g}),l==="new"&&e.jsx(he,{optionalName:c,onChange:t=>i(we(t))})]})})]})}const Qe=a=>new Promise(n=>{const i=new FileReader;i.onloadend=()=>n(i.result),i.readAsText(a)}),et={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function tt(a){const{company:n,templateEntry:i,onLineChange:l,onNewLineChange:d,onMajorFlagChange:p,onLineNameChange:c,onOptionalNameChange:m,onParamChange:h,onParamImport:g,onRemove:t}=a,{line:o,newLine:s,majorUpdate:j,templateName:u,optionalName:w,param:S}=i,{t:f}=L(),O=z(),{templates:y}=me(n),M=x.useRef(null),E=async r=>{var U;const b=(U=r.target.files)==null?void 0:U[0];if(console.log("handleFileUpload():: received file",b),!!b){if(b.type!=="application/json"){alert("Invalid file type!"),r.target.value="";return}try{const V=await Qe(b);h(JSON.parse(V))}catch(V){alert("Invalid file!"),r.target.value=""}}},B={"":f("Please select..."),...n===""||n==="new"?{}:y.reduce((r,b)=>({...r,[b.filename]:O(b.name)}),{}),new:f("Add a line...")},C=[{type:"select",label:f("Line"),value:o,options:B,disabledOptions:[""],onChange:r=>l(r),minW:150},{type:"input",label:f("Line code"),placeholder:"e.g. twl, gz1, sh1",value:s,onChange:r=>d(r),hidden:o!=="new"},{type:"custom",label:f("Major update"),component:e.jsx(Z,{selections:[{label:f("Yes"),value:!0},{label:f("No"),value:!1}],defaultValue:j,onChange:r=>p(r)}),hidden:o==="new"}],R=G.map(r=>({type:"input",label:O(A[r]),value:u[r],onChange:b=>c(r,b)}));return e.jsxs(de,{sx:et,children:[e.jsx(X,{size:"sm",variant:"ghost",icon:e.jsx(Ze,{}),"aria-label":f("Remove this line"),title:f("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:t}),e.jsxs(ne,{spacing:0,children:[e.jsx(P,{fields:[...C,...R],minW:110}),e.jsx(he,{optionalName:w,onChange:m})]}),e.jsx(ne,{children:S?e.jsxs(e.Fragment,{children:[e.jsx(Q,{as:Ye,boxSize:10}),e.jsxs(H,{as:"i",fontSize:"xs",children:["(",f("Size"),": ",JSON.stringify(S).length," ",f("chars"),")"]}),e.jsx(v,{size:"sm",onClick:()=>h(void 0),children:f("Remove")})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{as:"i",fontSize:"sm",children:f("Import from")}),e.jsxs(F,{spacing:1,children:[e.jsx(v,{size:"sm",onClick:g,children:"RMG"}),e.jsx(v,{size:"sm",onClick:()=>{var r;return(r=M.current)==null?void 0:r.click()},children:f("Local")}),e.jsx("input",{ref:M,type:"file",accept:".json",onChange:E})]})]})})]})}const at="rmg-bridge--",nt={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function st(a){const{templateId:n,onClose:i,onImport:l}=a,[d]=x.useState(crypto.randomUUID()),p="/rmg/#/import?"+new URLSearchParams({parentComponent:J.getAppName(),parentId:d});return x.useEffect(()=>{const c=new BroadcastChannel(at+d);return c.onmessage=m=>{const{event:h,data:g}=m.data;console.log("[rmg-templates] Received event from RMG app clip:",h),h==="CLOSE"?i():h==="IMPORT"&&l(g)},()=>{c.close()}},[n]),e.jsx(Re,{isOpen:!!n,onClose:i,sx:nt,children:e.jsx("iframe",{src:p,loading:"lazy"})})}function ot(){const{t:a}=L(),n=ae(),{company:i,templates:l}=_(t=>t.ticket),{templates:d,isLoading:p}=me(i),[c,m]=x.useState(),h=(t,o)=>{const s=d.find(j=>j.filename===o);n(He({id:t,line:o,name:s==null?void 0:s.name}))},g=t=>{c&&n(oe({id:c,param:t})),m(void 0)};return e.jsxs(re,{children:[p&&e.jsx(ke,{isIndeterminate:!0}),e.jsxs(ce,{children:[e.jsx(D,{as:"h5",size:"sm",children:a("Add or update templates")}),e.jsx(ge,{hasArrow:!0,label:a("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:e.jsx("span",{children:e.jsx(Q,{as:_e,ml:1})})})]}),e.jsx(le.div,{px:1,transform:"translateZ(0)",children:l.map(t=>e.jsx(tt,{company:i,templateEntry:t,onLineChange:o=>h(t.id,o),onNewLineChange:o=>n(Ee({id:t.id,newLine:o})),onMajorFlagChange:o=>n(Ie({id:t.id,majorUpdate:o})),onLineNameChange:(o,s)=>n(ze({id:t.id,lang:o,name:s})),onOptionalNameChange:o=>n(Be({id:t.id,optionalName:o})),onParamChange:o=>n(oe({id:t.id,param:o})),onParamImport:()=>m(t.id),onRemove:()=>n(Te(t.id))},t.id))}),e.jsx(F,{justifyContent:"flex-end",children:e.jsx(v,{variant:"ghost",size:"sm",leftIcon:e.jsx(K,{}),onClick:()=>n(Ae()),children:a("Add item")})}),e.jsx(st,{templateId:c,onClose:()=>m(void 0),onImport:g})]})}function it(a){const{companyErrors:n,templateErrors:i,onClose:l}=a,{t:d}=L(),p=z();return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(H,{children:d("Your inputs contain the following errors. Please fix it before submitting.")}),n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{as:"h5",size:"sm",my:2,children:d("Railway company")}),e.jsx(q,{"aria-label":"List of company errors",children:n.map((c,m)=>e.jsx(T,{children:p(ie[c])},m))})]}),Object.values(i).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{as:"h5",size:"sm",my:2,children:d("Templates")}),e.jsx(q,{"aria-label":"List of template errors",children:Object.entries(i).map(([c,m])=>e.jsxs(T,{children:[c,e.jsx(q,{children:m.map((h,g)=>e.jsx(T,{children:p(ie[h])},g))})]},c))})]})]}),e.jsx(te,{children:e.jsx(F,{children:e.jsx(v,{colorScheme:"primary",onClick:l,children:d("Go back")})})})]})}const lt=a=>{var n;return!!((n=a.match(/^https?:\/\//))!=null&&n[0])};function rt(a){const{haveBeenOpened:n,onHaveBeenOpenedChange:i,willBeOpened:l,onWillBeOpenedChange:d,refSource:p,onRefSourceChange:c,refLink:m,onRefLinkChange:h,justification:g,majorUpdateJustifications:t,onJustificationChange:o,onMajorUpdateJustificationChange:s,onNext:j}=a,{t:u}=L(),w=z(),S=[{label:u("Yes"),value:!0},{label:u("No"),value:!1}],f=Object.fromEntries([["",u("Please select...")],...Object.entries(pe).map(([C,R],r)=>[C,"".concat(r+1,". ").concat(w(R))])]),O=[{type:"custom",label:u("Have all of the lines been officially opened?"),component:e.jsx(Z,{selections:S,defaultValue:n,onChange:i})},{type:"custom",label:u("Will they be opened soon? Are all of the station names finalised?"),component:e.jsx(Z,{selections:S,defaultValue:l,onChange:d}),hidden:n},{type:"select",label:u("Reference source"),options:f,disabledOptions:[""],value:p,onChange:C=>c(C)},{type:"input",value:m,label:u("Reference link"),placeholder:u("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:h,validator:lt,isDisabled:p==="STATION_UPLOAD_IMAGE"},{type:"textarea",value:g,label:u("Justification"),placeholder:u("Briefly describe your changes and provide justification"),onChange:o}],y=Object.entries(t).map(([C,R])=>({type:"textarea",value:R,label:u("Justification for major update of")+" "+C,placeholder:u("Briefly describe your changes and provide justification"),onChange:r=>s(C,r)})),B=!(n||l)||!(p==="STATION_UPLOAD_IMAGE"||p&&m)||!g||Object.values(t).some(C=>!C);return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(H,{children:u("Please provide suitable source and justification.")}),e.jsx(P,{fields:[...O,...y],minW:"full"})]}),e.jsx(te,{children:e.jsx(v,{colorScheme:"primary",onClick:j,rightIcon:e.jsx(Xe,{}),isDisabled:B,children:u("Next")})})]})}function ct(a){var O;const{companyName:n,companyBlock:i,templateBlocks:l,haveBeenOpened:d,willBeOpened:p,refSource:c,refLink:m,justification:h,majorUpdateJustifications:g,onPrev:t,onClose:o}=a,{t:s}=L(),j=z(),u=je("primary.500","primary.300"),w=["**Lines opening status:** ".concat(d?"OPENED":p?"WILL BE OPENED SOON":"NOT READY FOR OPENING"),"**Reference source:** ".concat(c?j(pe[c]):"(Not Provided)"),"**Reference link:** ".concat(m||"(Not Provided)"),"**Justification:** ".concat(h||"(Not Provided)"),Object.entries(g).map(([y,M])=>"- Major update of ".concat(y,": ").concat(M)).join("\n"),Pe,(O=i==null?void 0:i.outerHTML)!=null?O:"",...l.map(y=>y.outerHTML)].join("\n\n"),S=new URLSearchParams({template:"new-templates-request.md",labels:"resources",title:"Resources: New templates of "+n}),f=async()=>{await navigator.clipboard.writeText(w)};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(H,{children:s("Follow the instructions below to open an Issue")+":"}),e.jsxs(xe,{children:[e.jsxs(T,{children:[s("Open")," ",e.jsxs(ve,{color:u,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+S.toString(),isExternal:!0,children:["Issue: New Templates Request ",e.jsx(Q,{as:We})]})]}),e.jsxs(T,{children:[s("Click copy button and paste into issue body")," ",e.jsx(v,{size:"xs",leftIcon:e.jsx($e,{}),onClick:f,children:s("Copy")})]})]})]}),e.jsxs(te,{children:[e.jsx(v,{variant:"ghost",onClick:t,mr:"auto",leftIcon:e.jsx(qe,{}),children:s("Previous")}),e.jsx(v,{colorScheme:"primary",onClick:o,children:s("Close")})]})]})}function dt(a){const{isOpen:n,onClose:i}=a,{t:l}=L(),[d,p]=x.useState([]),[c,m]=x.useState({}),[h,g]=x.useState(!1),[t,o]=x.useState(!1),[s,j]=x.useState(""),[u,w]=x.useState(""),[S,f]=x.useState(""),[O,y]=x.useState({}),[M,E]=x.useState(!1),{coreCompanyConfig:B,otherCompanyConfig:C,templateList:R}=_(k=>k.app),r=_(k=>k.ticket),b=I.getCompanyEnglishName(r,[...B,...C]),U=I.getCompanyBlock(r),V=I.getTemplateBlocks(r);x.useEffect(()=>{if(n){p(I.getCompanyErrors(r)),m(I.getTemplateErrors(r));const k=I.getMajorUpdateNames(r,R).reduce(($,Y)=>({...$,[Y]:""}),{});y(k)}else g(!1),o(!1),j(""),f(""),y({}),E(!1)},[n]);const W=d.length>0||Object.values(c).flat().length>0,ue=!W&&!M;return e.jsxs(Ce,{blockScrollOnMount:!1,isOpen:n,onClose:i,scrollBehavior:"inside",children:[e.jsx(ye,{}),e.jsxs(be,{children:[e.jsx(Se,{children:l("Submit templates")}),e.jsx(Oe,{}),W&&e.jsx(it,{companyErrors:d,templateErrors:c,onClose:i}),ue&&e.jsx(rt,{haveBeenOpened:h,onHaveBeenOpenedChange:g,willBeOpened:t,onWillBeOpenedChange:o,refSource:s,onRefSourceChange:j,refLink:u,onRefLinkChange:w,justification:S,majorUpdateJustifications:O,onJustificationChange:f,onMajorUpdateJustificationChange:(k,$)=>y(Y=>({...Y,[k]:$})),onNext:()=>E(!0)}),!W&&M&&e.jsx(ct,{companyName:b,companyBlock:U,templateBlocks:V,haveBeenOpened:h,willBeOpened:t,refSource:s,refLink:u,justification:S,majorUpdateJustifications:O,onPrev:()=>E(!1),onClose:i})]})]})}const pt={width:{base:"100%",md:520},alignSelf:"center","& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto",bg:"inherit"},"& > div:nth-of-type(2)":{my:2}};function gt(){const{t:a}=L(),n=Je(),i=ae(),[l,d]=x.useState(!1),p=()=>{J.isStandaloneWindow()?n("/"):J.openApp("rmg-templates")},c=()=>{i(Ue()),J.event(Ve.RESET_TICKETS,{})};return e.jsxs(Fe,{sx:pt,children:[e.jsxs(se,{children:[e.jsx(Ke,{}),e.jsx(ot,{})]}),e.jsxs(se,{children:[e.jsx(v,{size:"sm",onClick:p,children:a("Back to list")}),e.jsxs(F,{ml:"auto",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:c,children:a("Reset")}),e.jsx(v,{size:"sm",colorScheme:"primary",onClick:()=>d(!0),children:a("Submit")})]})]}),e.jsx(dt,{isOpen:l,onClose:()=>d(!1)})]})}export{gt as default};
