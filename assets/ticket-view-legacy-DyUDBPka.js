System.register(["./mantine-legacy-J5hmvK9B.js","./index-legacy-DP-UqeF1.js","./use-templates-legacy-Vq2G2DUr.js","./react-legacy-CxCkuJ5-.js"],(function(e,n){"use strict";var a,t,s,i,l,o,r,c,d,p,m,u,h,x,j,g,f,v,b,y,C,_,w,k,N,z,S,I,O,T,R,L,P,E,A,B,U,F,$,M,D,J,G,q,H,Y,V,K,Q,W,X,Z,ee,ne,ae,te,se,ie,le,oe,re,ce,de,pe;return{setters:[e=>{a=e.j,t=e.B,s=e.o,i=e.F,l=e.p,o=e.G,r=e.S,c=e.q,d=e.s,p=e.t,m=e.u,u=e.v,h=e.w,x=e.T,j=e.x,g=e.C,f=e.y,v=e.N,b=e.l,y=e.z,C=e.r,_=e.E,w=e.L,k=e.H,N=e.I,z=e.J,S=e.K,I=e.O,O=e.P,T=e.Q,R=e.U,L=e.V,P=e.W,E=e.X,A=e.e,B=e.h,U=e.D,F=e.f},e=>{$=e.L,M=e.S,D=e.a,J=e.u,G=e.b,q=e.c,H=e.d,Y=e.e,V=e.r,K=e.f,Q=e.g,W=e.h,X=e.i,Z=e.j,ee=e.k,ne=e.I,ae=e.R,te=e.G,se=e.t,ie=e.l,le=e.E},e=>{oe=e.u,re=e.a,ce=e.b},e=>{de=e.u,pe=e.r}],execute:function(){var n=document.createElement("style");function me(e){const{optionalName:n,onChange:u}=e,{t:h}=de(),x=oe(),j=Object.entries($).map((([e,a])=>({value:e,label:x(a),disabled:M.includes(e)||n.some((n=>n[0]===e))}))),g=()=>{const e=Object.keys($).filter((e=>!M.includes(e)&&!n.some((n=>n[0]===e))));e.includes("ko")?u([...n,["ko",""]]):u([...n,[e[0],""]])};return 0===n.length?a.jsx(t,{leftSection:a.jsx(s,{}),onClick:g,children:h("Add a name in another language")}):a.jsx(i,{legend:h("Multi-languages"),children:n.map((([e,t],i,x)=>a.jsxs(l,{pt:4,align:"center","data-testid":"entry-card-stack-"+e,children:[a.jsxs(o,{gap:"xs",flex:1,grow:!0,children:[a.jsx(r,{size:"xs","aria-label":h("Language"),value:e,onChange:a=>{return t=e,s=a,void u(n.map((e=>e[0]===t?[s,e[1]]:e)));var t,s},data:j,searchable:!0}),a.jsx(c,{size:"xs","aria-label":h("Name"),placeholder:h("Enter name"),value:t,onChange:({currentTarget:{value:a}})=>((e,a)=>{u(n.map((n=>n[0]===e?[n[0],a]:n)))})(e,a)})]}),a.jsxs(l,{ml:8,wrap:"nowrap",children:[i===x.length-1?a.jsx(d,{size:"sm",variant:"filled","aria-label":h("Add a name in another language"),title:h("Add a name in another language"),onClick:g,children:a.jsx(s,{})}):a.jsx(p,{w:22}),a.jsx(d,{size:"sm",variant:"outline","aria-label":h("Remove this name"),title:h("Remove this name"),onClick:()=>(e=>{u(n.filter((n=>n[0]!==e)))})(e),ml:4,children:a.jsx(m,{})})]})]},i)))})}function ue(){const{t:e}=de(),n=oe(),t=D(),{company:s,newCompany:i,companyName:l,companyOptionalName:d}=J((e=>e.ticket)),p=re();return a.jsxs(u,{children:[a.jsx(h,{children:a.jsx(x,{order:2,size:"h4",children:e("Railway company")})}),a.jsxs(j,{py:"xs",gap:"xs",children:[a.jsxs(o,{gap:"xs",grow:!0,children:[a.jsx(r,{label:e("Company"),value:s,onChange:e=>t(G(e)),data:[...p,{value:"new",label:e("Add a company...")}],searchable:!0}),"new"===s&&a.jsx(c,{label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:i,onChange:({currentTarget:{value:e}})=>t(q(e))})]}),"new"===s&&a.jsx(o,{gap:"xs",grow:!0,children:M.map((e=>a.jsx(c,{label:n($[e]),value:l[e],onChange:({currentTarget:{value:n}})=>t(H({lang:e,name:n}))},e)))}),"new"===s&&a.jsx(me,{optionalName:d,onChange:e=>t(Y(e))})]})]})}n.textContent="._root_2eej5_1{box-shadow:var(--mantine-shadow-sm)}._close-btn_2eej5_6{position:absolute;top:var(--mantine-spacing-xs);right:var(--mantine-spacing-xs)}._file_2eej5_12{margin-left:var(--mantine-spacing-xs);margin-right:calc(-1 * var(--mantine-spacing-xs))}._file_2eej5_12>span{font-style:italic;font-size:var(--mantine-font-size-sm);text-wrap:nowrap}._file_2eej5_12>span._file-size_2eej5_23{font-size:var(--mantine-font-size-xs)}._file_2eej5_12 input[type=file]{display:none}._content_euz2o_1,._body_euz2o_7,._stepper-root_euz2o_14,._stepper-content_euz2o_21{display:flex;flex-direction:column;overflow:hidden}._step-body_euz2o_28{overflow-y:auto}\n/*$vite$:1*/",document.head.appendChild(n),e("default",(function(){const{t:e}=de(),n=D(),[s,i]=pe.useState(!1);return a.jsxs(A,{w:{base:"100%",sm:600},style:{alignSelf:"center"},children:[a.jsxs(B,{direction:"column",px:"xs",style:{overflowY:"auto"},children:[a.jsx(Le,{}),a.jsx(ue,{}),a.jsx(ve,{})]}),a.jsx(U,{}),a.jsx(F,{children:a.jsxs(o,{flex:1,gap:"sm",children:[a.jsx(t,{variant:"default",onClick:()=>{C.openApp({appId:"rmg-templates"})},children:e("Back to list")}),a.jsx(t,{variant:"default",ml:"auto",onClick:()=>{n(ie()),C.event(le.RESET_TICKETS,{})},children:e("Reset")}),a.jsx(t,{onClick:()=>i(!0),children:e("Submit")})]})}),a.jsx(Re,{isOpen:s,onClose:()=>i(!1)})]})}));const he={root:"_root_2eej5_1","close-btn":"_close-btn_2eej5_6",file:"_file_2eej5_12"},xe=e=>new Promise((n=>{const a=new FileReader;a.onloadend=()=>n(a.result),a.readAsText(e)}));function je(e){const{company:n,templateEntry:s,onLineChange:i,onNewLineChange:l,onLineNameChange:r,onOptionalNameChange:d,onParamChange:p,onParamImport:m,onRemove:u}=e,{line:h,newLine:x,templateName:C,optionalName:_,param:w}=s,{t:k}=de(),N=oe(),{templates:z}=ce(n),S=pe.useRef(null),I=[{value:"",label:k("Please select..."),disabled:!0},...""===n||"new"===n?[]:z.map((e=>({value:e.filename,label:N(e.name)}))),{value:"new",label:k("Add a line...")}];return a.jsxs(g,{withBorder:!0,className:he.root,children:[a.jsx(f,{className:he["close-btn"],"aria-label":k("Remove this line"),title:k("Remove this line"),onClick:u}),a.jsxs(j,{gap:"xs",children:[a.jsxs(o,{gap:"xs",grow:!0,children:[a.jsx(v,{label:k("Line"),value:h,onChange:({currentTarget:{value:e}})=>i(e),data:I}),"new"===h&&a.jsx(c,{label:k("Line code"),placeholder:"e.g. twl, gz1, sh1",value:x,onChange:({currentTarget:{value:e}})=>l(e)})]}),a.jsx(o,{gap:"xs",align:"center",justify:"center",className:he.file,children:w?a.jsxs(a.Fragment,{children:[a.jsx(b,{style:{fontSize:32},children:a.jsx(y,{})}),a.jsxs(b,{component:"span",fs:"italic",size:"xs",children:["(",JSON.stringify(w).length," ",k("chars"),")"]}),a.jsx(t,{variant:"default",size:"xs",onClick:()=>p(void 0),children:k("Remove")})]}):a.jsxs(a.Fragment,{children:[a.jsx(b,{component:"span",fs:"italic",size:"sm",children:k("Import from")}),a.jsx(t,{variant:"light",size:"xs",onClick:m,children:"RMG"}),a.jsx(t,{variant:"light",size:"xs",onClick:()=>S.current?.click(),children:k("Local")}),a.jsx("input",{ref:S,type:"file",accept:".json",onChange:async e=>{const n=e.target.files?.[0];if(console.log("handleFileUpload():: received file",n),n){if("application/json"!==n.type)return alert("Invalid file type!"),void(e.target.value="");try{const e=await xe(n);p(JSON.parse(e))}catch{alert("Invalid file!"),e.target.value=""}}}})]})}),a.jsx(o,{gap:"xs",grow:!0,children:M.map((e=>a.jsx(c,{label:N($[e]),value:C[e],onChange:({currentTarget:{value:n}})=>r(e,n)},e)))}),a.jsx(me,{optionalName:_,onChange:d})]})]})}const ge="rmg-bridge--";function fe(e){const{templateId:n,onClose:t,onImport:s}=e,[i]=pe.useState(crypto.randomUUID()),l="/rmg/#/import?"+new URLSearchParams({parentComponent:C.getAppName(),parentId:i});return pe.useEffect((()=>{const e=new BroadcastChannel(ge+i);return e.onmessage=e=>{const{event:n,data:a}=e.data;console.log("[rmg-templates] Received event from RMG app clip:",n),"CLOSE"===n?t():"IMPORT"===n&&s(a)},()=>{e.close()}}),[n]),a.jsx(_,{opened:!!n,onClose:t,styles:{content:{height:500}},children:a.jsx("iframe",{src:l,loading:"lazy"})})}function ve(){const{t:e}=de(),n=D(),{company:i,templates:l}=J((e=>e.ticket)),{templates:o,isLoading:r}=ce(i),[c,d]=pe.useState();return a.jsxs(u,{children:[a.jsx(w,{visible:r}),a.jsx(h,{children:a.jsx(x,{order:2,size:"h4",children:e("Add or update templates")})}),a.jsxs(j,{py:4,gap:"xs",children:[l.map((e=>a.jsx(je,{company:i,templateEntry:e,onLineChange:a=>((e,a)=>{const t=o.find((e=>e.filename===a));n(ee({id:e,line:a,name:t?.name}))})(e.id,a),onNewLineChange:a=>n(X({id:e.id,newLine:a})),onLineNameChange:(a,t)=>n(W({id:e.id,lang:a,name:t})),onOptionalNameChange:a=>n(Q({id:e.id,optionalName:a})),onParamChange:a=>n(K({id:e.id,param:a})),onParamImport:()=>d(e.id),onRemove:()=>n(V(e.id))},e.id))),a.jsx(t,{variant:"outline",size:"xs",leftSection:a.jsx(s,{}),ml:"auto",onClick:()=>n(Z()),children:e("Add item")})]}),a.jsx(fe,{templateId:c,onClose:()=>d(void 0),onImport:e=>{c&&n(K({id:c,param:e})),d(void 0)}})]})}const be={content:"_content_euz2o_1",body:"_body_euz2o_7","stepper-root":"_stepper-root_euz2o_14","stepper-content":"_stepper-content_euz2o_21","step-body":"_step-body_euz2o_28"};function ye(e){const{companyErrors:n,templateErrors:s,onClose:i}=e,{t:l}=de(),r=oe();return a.jsxs(a.Fragment,{children:[a.jsxs(j,{gap:"xs",className:be["step-body"],children:[a.jsx(b,{children:l("Your inputs contain the following errors. Please fix it before submitting.")}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(x,{order:3,size:"h5",children:l("Railway company")}),a.jsx(k,{size:"sm",withPadding:!0,"aria-label":"List of company errors",children:n.map(((e,n)=>a.jsx(k.Item,{children:r(ne[e])},n)))})]}),Object.values(s).flat().length>0&&a.jsxs(a.Fragment,{children:[a.jsx(x,{order:3,size:"h5",children:l("Templates")}),a.jsx(k,{size:"sm",withPadding:!0,"aria-label":"List of template errors",children:Object.entries(s).map((([e,n])=>a.jsxs(k.Item,{children:[e,a.jsx(k,{size:"sm",withPadding:!0,children:n.map(((e,n)=>a.jsx(k.Item,{children:r(ne[e])},n)))})]},e)))})]})]}),a.jsx(o,{gap:"sm",pt:"xs",children:a.jsx(t,{variant:"default",ml:"auto",onClick:i,children:l("Go back")})})]})}const Ce={hasDiagramInStation:!1,isOpened:!1,soonToBeOpened:!1,source:"",link:"",comments:"",majorUpdateComments:{}},_e=()=>Ce,we=e=>{const n=e.isOpened||e.soonToBeOpened;return e.hasDiagramInStation&&n},ke=e=>{const n=we(e),a="STATION_UPLOAD_IMAGE"===e.source||e.source&&e.link,t=Object.values(e.majorUpdateComments).every((e=>!!e));return Boolean(n&&a&&e.comments&&t)},Ne=e=>{const{hasDiagramInStation:n,isOpened:a,soonToBeOpened:t,source:s,link:i,comments:l,majorUpdateComments:o}=e;return`| Item | Value |\n|---|---|\n| Route map in stations | ${n?"Yes":"No"} |\n|    Opening status     | ${a?"Opened":t?"To be opened":"Not yet opened"} |\n| Reference source type | ${s?ae[s].en:"Not selected"} |\n|     Reference link    | ${i} |\n|     Justification     | ${l.replaceAll("\n","<br>")} |\n${Object.entries(o).map((([e,n])=>`| Major update of ${e} | ${n.replaceAll("\n","<br.")} |`)).join("\n")}`},ze=e=>!!e.match(/^https?:\/\//)?.[0],Se="true",Ie="false";function Oe(e){const{justification:n,onJustificationUpdate:s,onNext:i}=e,{t:l}=de(),r=oe(),d=[{label:l("Yes"),value:Se},{label:l("No"),value:Ie}],p=[{value:"",label:l("Please select..."),disabled:!0},...Object.entries(ae).map((([e,n],a)=>({value:e,label:`${a+1}. ${r(n)}`})))],m=we(n),u=ke(n);return a.jsxs(a.Fragment,{children:[a.jsxs(j,{gap:"xs",className:be["step-body"],children:[a.jsx(b,{children:l("Please complete the questionnaire below.")}),a.jsxs(j,{gap:"xs",children:[a.jsx(N,{label:l("Have all of the lines been officially opened?"),data:d,value:n.isOpened?Se:Ie,onChange:e=>s("isOpened",e===Se)}),!n.isOpened&&a.jsx(N,{label:l("Are they soon to be opened? Are all of the station names finalised?"),data:d,value:n.soonToBeOpened?Se:Ie,onChange:e=>s("soonToBeOpened",e===Se)}),a.jsx(N,{label:l("Is route map (network map) displayed in the stations of these lines?"),data:d,value:n.hasDiagramInStation?Se:Ie,onChange:e=>s("hasDiagramInStation",e===Se)})]}),m?a.jsxs(a.Fragment,{children:[a.jsx(b,{children:l("Please provide suitable source and justification.")}),a.jsxs(j,{gap:"xs",children:[a.jsx(v,{label:l("Reference source"),value:n.source,onChange:({currentTarget:{value:e}})=>s("source",e),data:p}),a.jsx(c,{label:l("Reference link"),placeholder:l("Enter a valid URL, e.g.")+" https://en.wikipedia.org",value:n.link,onChange:({currentTarget:{value:e}})=>s("link",e),disabled:"STATION_UPLOAD_IMAGE"===n.source,error:n.link&&!ze(n.link)?l("URL is invalid"):void 0}),a.jsx(z,{label:l("Justification"),placeholder:l("Briefly describe your changes and provide justification"),value:n.comments,onChange:({currentTarget:{value:e}})=>s("comments",e),autosize:!0,minRows:3})]})]}):a.jsx(b,{fs:"italic",children:l("Sorry. The templates uploaded do not meet our acceptance criteria.")})]}),a.jsx(o,{gap:"sm",pt:"xs",children:a.jsx(t,{ml:"auto",onClick:i,rightSection:a.jsx(S,{}),disabled:!u,children:l("Next")})})]})}function Te(e){const{companyName:n,companyBlock:s,templateBlocks:i,justification:l,onPrev:r,onClose:c}=e,{t:d}=de(),p=[Ne(l),te,s?.outerHTML??"",...i.map((e=>e.outerHTML))].join("\n\n"),m=new URLSearchParams({template:"new-templates-request.md",labels:"resources",title:"Resources: New templates of "+n});return a.jsxs(a.Fragment,{children:[a.jsxs(j,{gap:"xs",className:be["step-body"],children:[a.jsx(b,{children:d("Follow the instructions below to open an Issue")+":"}),a.jsxs(k,{type:"ordered",withPadding:!0,children:[a.jsxs(k.Item,{children:[d("Open")," ",a.jsxs(I,{href:"https://github.com/railmapgen/rmg-templates/issues/new?"+m.toString(),target:"_blank",children:["Issue: New Templates Request ",a.jsx(O,{})]})]}),a.jsxs(k.Item,{children:[d("Click copy button and paste into issue body")," ",a.jsx(t,{size:"xs",variant:"light",leftSection:a.jsx(T,{}),onClick:async()=>{await navigator.clipboard.writeText(p)},children:d("Copy")})]})]})]}),a.jsxs(o,{gap:"sm",pt:"xs",children:[a.jsx(t,{variant:"default",onClick:r,leftSection:a.jsx(R,{}),children:d("Previous")}),a.jsx(t,{ml:"auto",onClick:c,children:d("Close")})]})]})}function Re(e){const{isOpen:n,onClose:t}=e,{t:s}=de(),[i,l]=pe.useState([]),[o,r]=pe.useState({}),[c,d]=pe.useState(_e()),[p,m]=pe.useState(!1),{coreCompanyConfig:u,otherCompanyConfig:h,templateList:x}=J((e=>e.app)),j=J((e=>e.ticket)),g=se.getCompanyEnglishName(j,[...u,...h]),f=se.getCompanyBlock(j),v=se.getTemplateBlocks(j),b=(e,n)=>{d((a=>({...a,[e]:n})))};pe.useEffect((()=>{if(n){l(se.getCompanyErrors(j)),r(se.getTemplateErrors(j));const e=se.getMajorUpdateNames(j,x).reduce(((e,n)=>({...e,[n]:""})),{});b("majorUpdateComments",e)}else m(!1)}),[n]);const y=i.length>0||Object.values(o).flat().length>0,C=!y&&!p;return a.jsx(L,{classNames:{content:be.content,body:be.body},opened:n,onClose:t,title:s("Submit templates"),children:a.jsxs(P,{active:y?0:C?1:2,classNames:{root:be["stepper-root"],content:be["stepper-content"]},children:[a.jsx(P.Step,{label:s("Validate"),children:a.jsx(ye,{companyErrors:i,templateErrors:o,onClose:t})}),a.jsx(P.Step,{label:s("Justify"),children:a.jsx(Oe,{justification:c,onJustificationUpdate:b,onNext:()=>m(!0)})}),a.jsx(P.Step,{label:s("Submit"),children:a.jsx(Te,{companyName:g,companyBlock:f,templateBlocks:v,justification:c,onPrev:()=>m(!1),onClose:t})})]})})}function Le(){const{t:e}=de();return a.jsxs(u,{children:[a.jsx(h,{children:a.jsx(x,{order:2,size:"h4",children:e("Acceptance criteria")})}),a.jsxs(E,{direction:"column",py:"xs",children:[a.jsx(b,{children:e("acceptanceCriteria.preamble")}),a.jsxs(k,{withPadding:!0,children:[a.jsx(k.Item,{children:e("acceptanceCriteria.item1")}),a.jsx(k.Item,{children:e("acceptanceCriteria.item2")})]})]})]})}}}}));
