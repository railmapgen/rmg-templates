import{j as e,t as v,v as S,X as R,Y as L,r as g}from"./chakra-4d1cedbe.js";import{u as _,r as m,R as y,a as T}from"./index-e86f816f.js";import{P as A,T as O}from"./templates-grid-fc86d2ba.js";import{u as $,k as M,r}from"./react-d5c86316.js";import{E as p}from"./use-templates-ce2cbd78.js";const b="rmg-templates-bridge--";function z(){const{t:i}=$(),[d]=M(),E=d.get("parentId"),o=d.get("parentComponent"),{selectedCompany:c}=_(t=>t.app),[a,l]=r.useState(),[P,u]=r.useState(!1),[C,f]=r.useState(!1),n=r.useRef();r.useEffect(()=>{var t;return n.current=new BroadcastChannel(b+E),m.event(p.APP_CLIP_VIEW_OPENED,{parentComponent:o}),console.log(`[${(t=n.current)==null?void 0:t.name}] App clip connection established, parentComponent=${o}`),()=>{var s;(s=n.current)==null||s.close()}},[]),r.useEffect(()=>{l(void 0)},[c]);const I=async()=>{var t,s;console.log(`[${(t=n.current)==null?void 0:t.name}] Emitting IMPORT event, company=${c}, template=${a}`);try{u(!0);const j=await(await fetch(`/rmg-templates/resources/templates/${c}/${a}.json`)).json();(s=n.current)==null||s.postMessage({event:"IMPORT",meta:{selectedCompany:c,selectedTemplate:a},data:JSON.stringify(j)}),m.event(p.APP_CLIP_VIEW_IMPORT,{parentComponent:o})}catch(h){f(!0)}finally{u(!1),l(void 0)}},x=()=>{var t,s;console.log(`[${(t=n.current)==null?void 0:t.name}] Emitting CLOSE event`),(s=n.current)==null||s.postMessage({event:"CLOSE"}),m.event(p.APP_CLIP_VIEW_CLOSED,{parentComponent:o}),l(void 0),f(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{children:[P&&e.jsx(T,{isIndeterminate:!0}),C&&e.jsxs(v,{status:"error",variant:"solid",size:"xs",pl:3,pr:1,py:1,children:[e.jsx(S,{}),i("Unable to import selected template.")]}),e.jsx(A,{}),e.jsx(O,{selectedTemplate:a,onTemplateSelect:l})]}),e.jsx(R,{}),e.jsxs(L,{p:2,justifyContent:"flex-end",children:[e.jsx(g,{size:"sm",onClick:x,children:i("Close")}),e.jsx(g,{size:"sm",colorScheme:"primary",isDisabled:!a,onClick:I,children:i("Import")})]})]})}export{z as default};
