import{j as e,B as $,X as E,a1 as k,E as ee,a2 as ae,a3 as U,r as w,t as z,Y as R,F as O,a4 as ne,q as J,a5 as A,a6 as b,s as V,v as te,a7 as se,L as oe,a8 as ie,M as re,a9 as le,n as ce,o as he}from"./chakra-bf74f401.js";import{u as y,f as G,b as I,g as de,h as pe,i as me,j as Y,c as N,r as T,k as ue,l as ge,m as fe,n as ze,o as je,p as q,q as xe,t as He,v as ve,w as M,e as Ce,x as ke}from"./index-dcc18db8.js";import{u as D,a as X,I as K,G as ye,E as Me}from"./use-templates-1084db3d.js";import{r as j,u as Se}from"./react-10467568.js";var Q=["en","ko","zh-Hans","zh-Hant"],Z={ar:{ar:"العربية",en:"Arabic",ko:"아랍어","zh-Hans":"阿拉伯文","zh-Hant":"阿拉伯文"},az:{az:"Azərbaycanca",en:"Azerbaijani",ko:"아제르바이잔어","zh-Hans":"阿塞拜疆文","zh-Hant":"阿塞拜疆文"},ca:{ca:"Català",en:"Catalan",ko:"카탈루냐어","zh-Hans":"加泰罗尼亚文","zh-Hant":"加泰隆尼亞文"},da:{da:"Dansk",en:"Danish",ko:"덴마크어","zh-Hans":"丹麦文","zh-Hant":"丹麥文"},de:{de:"Deutsch",en:"German",ko:"독일어","zh-Hans":"德文","zh-Hant":"德文"},el:{el:"Ελληνικά",en:"Greek",ko:"그리스어","zh-Hans":"希腊文","zh-Hant":"希臘文"},en:{en:"English",ko:"영어","zh-Hans":"英文","zh-Hant":"英文"},es:{en:"Spanish",es:"Español",ko:"스페인어","zh-Hans":"西班牙文","zh-Hant":"西班牙文"},fa:{en:"Persian",fa:"فارسی",ko:"페르시아어","zh-Hans":"波斯文","zh-Hant":"波斯文"},fr:{en:"French",fr:"Français",ko:"프랑스어","zh-Hans":"法文","zh-Hant":"法文"},ga:{en:"Irish",ga:"Gaeilge",ko:"아일랜드어","zh-Hans":"爱尔兰文","zh-Hant":"愛爾蘭文"},gd:{en:"Scottish Gaelic",gd:"Gàidhlig",ko:"스코틀랜드 게일어","zh-Hans":"苏格兰盖尔文","zh-Hant":"蘇格蘭蓋爾文"},hi:{en:"Hindi",hi:"हिन्दी",ko:"힌디어","zh-Hans":"印地文","zh-Hant":"印地文"},hu:{en:"Hungarian",hu:"Magyar",ko:"헝가리어","zh-Hans":"匈牙利文","zh-Hant":"匈牙利文"},id:{en:"Indoesian",id:"Bahasa Indonesia",ko:"인도네시아어","zh-Hans":"印尼文","zh-Hant":"印尼文"},it:{en:"Italian",it:"Italiano",ko:"이탈리아어","zh-Hans":"意大利文","zh-Hant":"意大利文"},ja:{en:"Japanese",ja:"日本語",ko:"일본어","zh-Hans":"日文","zh-Hant":"日文"},ko:{en:"Korean",ko:"한국어","zh-Hans":"韩文","zh-Hant":"韓文"},ms:{en:"Malay",ko:"말레이어",ms:"Bahasa Melayu","zh-Hans":"马来文","zh-Hant":"馬來文"},no:{en:"Norwegian",ko:"노르웨이어",no:"Norsk","zh-Hans":"挪威文","zh-Hant":"挪威文"},pl:{en:"Polish",ko:"폴란드어",pl:"Polski","zh-Hans":"波兰文","zh-Hant":"波蘭文"},pt:{en:"Portuguese",ko:"포르투갈어",pt:"Português","zh-Hans":"葡萄牙文","zh-Hant":"葡萄牙文"},ro:{en:"Romanian",ko:"루마니아어",ro:"Română","zh-Hans":"罗马尼亚文","zh-Hant":"羅馬尼亞文"},ru:{en:"Russian",ko:"러시아어",ru:"Русский","zh-Hans":"俄文","zh-Hant":"俄文"},sv:{en:"Swedish",ko:"스웨덴어",sv:"Svenska","zh-Hans":"瑞典文","zh-Hant":"瑞典文"},th:{en:"Thai",ko:"태국어",th:"ภาษาไทย","zh-Hans":"泰文","zh-Hant":"泰文"},tr:{en:"Turkish",ko:"튀르키예어",tr:"Türkçe","zh-Hans":"土耳其文","zh-Hant":"土耳其文"},ur:{en:"Urdo",ko:"우르두어",ur:"اردو","zh-Hans":"乌尔都文","zh-Hant":"烏爾都文"},uz:{en:"Uzbek",ko:"우즈베크어",uz:"Oʻzbekcha","zh-Hans":"乌兹别克文","zh-Hant":"烏茲別克文"},vi:{en:"Vietnamese",ko:"베트남어",vi:"Tiếng Việt","zh-Hans":"越南文","zh-Hant":"越南文"},zh:{en:"Chinese",ko:"중국어",zh:"中文","zh-Hans":"中文","zh-Hant":"中文"},"zh-CN":{en:"Simplified Chinese (China)",ko:"중국어 간체자(중국)","zh-CN":"简体中文","zh-Hans":"简体中文（中国）","zh-Hant":"簡體中文（中國）"},"zh-Hans":{en:"Simplified Chinese",ko:"중국어 간체자","zh-Hans":"简体中文","zh-Hant":"簡體中文"},"zh-Hant":{en:"Traditional Chinese",ko:"중국어 정체자","zh-Hans":"繁体中文","zh-Hant":"繁體中文"},"zh-HK":{en:"Traditional Chinese (Hong Kong)",ko:"중국어 정체자(홍콩)","zh-Hans":"繁体中文（香港）","zh-Hant":"繁體中文（香港）","zh-HK":"繁體中文"},"zh-TW":{en:"Traditional Chinese (Taiwan)",ko:"중국어 정체자(대만)","zh-Hans":"繁体中文（台湾）","zh-Hant":"繁體中文（台灣）","zh-TW":"正體中文"}};function be(){const{t:a,i18n:t}=y(),o=D(),m=G(),{companyConfig:r}=I(n=>n.app),{company:d,newCompany:i,companyName:p}=I(n=>n.ticket),l={...r.map(n=>[n.id,o(n.name)]).sort((n,h)=>n[1].localeCompare(h[1],t.languages[0])).reduce((n,h)=>({...n,[h[0]]:h[1]}),{"":a("Please select...")}),new:a("Add a company...")},u=[{type:"select",label:a("Company"),value:d,options:l,disabledOptions:[""],onChange:n=>m(de(n))},{type:"input",label:a("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:i,onChange:n=>m(pe(n)),hidden:d!=="new"}],s=Q.map(n=>({type:"input",label:o(Z[n]),value:p[n],onChange:h=>m(me({lang:n,name:h}))}));return e.jsxs($,{as:"section",children:[e.jsx(E,{as:"h5",size:"sm",mb:2,children:a("Railway company")}),e.jsxs(Y,{direction:"column",children:[e.jsx(N,{fields:u}),d==="new"&&e.jsx(N,{fields:s})]})]})}const we=a=>new Promise(t=>{const o=new FileReader;o.onloadend=()=>t(o.result),o.readAsText(a)});function Ie(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(a)}function Le(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(a)}function Te(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(a)}function Ee(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(a)}function Ne(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"}}]})(a)}function Re(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(a)}function Be(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(a)}function Fe(a){return k({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(a)}const Pe={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function Ae(a){const{company:t,templateEntry:o,onLineChange:m,onNewLineChange:r,onMajorFlagChange:d,onLineNameChange:i,onParamChange:p,onParamImport:l,onRemove:u}=a,{line:s,newLine:n,majorUpdate:h,templateName:x,param:C}=o,{t:g}=y(),H=D(),{templates:B}=X(t),L=j.useRef(null),F=async c=>{var W;const f=(W=c.target.files)==null?void 0:W[0];if(console.log("handleFileUpload():: received file",f),!!f){if(f.type!=="application/json"){alert("Invalid file type!"),c.target.value="";return}try{const _=await we(f);p(JSON.parse(_))}catch(_){alert("Invalid file!"),c.target.value=""}}},S={"":g("Please select..."),...t===""||t==="new"?{}:B.reduce((c,f)=>({...c,[f.filename]:H(f.name)}),{}),new:g("Add a line...")},P=[{type:"select",label:g("Line"),value:s,options:S,disabledOptions:[""],onChange:c=>m(c),minW:150},{type:"input",label:g("Line code"),placeholder:"e.g. twl, gz1, sh1",value:n,onChange:c=>r(c),hidden:s!=="new"},{type:"switch",label:g("Major update"),isChecked:h,onChange:c=>d(c),hidden:s==="new",oneLine:!0}],v=Q.map(c=>({type:"input",label:H(Z[c]),value:x[c],onChange:f=>i(c,f),minW:c==="en"?260:void 0}));return e.jsxs(Y,{sx:Pe,children:[e.jsx(ee,{size:"sm",variant:"ghost",icon:e.jsx(Fe,{}),"aria-label":g("Remove this line"),title:g("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:u}),e.jsx(N,{fields:[...P,...v],minW:110}),e.jsx(ae,{children:C?e.jsxs(e.Fragment,{children:[e.jsx(U,{as:Ne,boxSize:10}),e.jsxs(w,{as:"i",fontSize:"xs",children:["(",g("Size"),": ",JSON.stringify(C).length," ",g("chars"),")"]}),e.jsx(z,{size:"sm",onClick:()=>p(void 0),children:g("Remove")})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{as:"i",fontSize:"sm",children:g("Import from")}),e.jsxs(R,{spacing:1,children:[e.jsx(z,{size:"sm",onClick:l,children:"RMG"}),e.jsx(z,{size:"sm",onClick:()=>{var c;return(c=L.current)==null?void 0:c.click()},children:g("Local")}),e.jsx("input",{ref:L,type:"file",accept:".json",onChange:F})]})]})})]})}const Oe="rmg-bridge--",Ue={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function Je(a){const{templateId:t,onClose:o,onImport:m}=a,[r]=j.useState(crypto.randomUUID()),d="/rmg/import?"+new URLSearchParams({parentComponent:T.getAppName(),parentId:r});return j.useEffect(()=>{const i=new BroadcastChannel(Oe+r);return i.onmessage=p=>{const{event:l,data:u}=p.data;console.log("[rmg-templates] Received event from RMG app clip:",l),l==="CLOSE"?o():l==="IMPORT"&&m(u)},()=>{i.close()}},[t]),e.jsx(ue,{isOpen:!!t,onClose:o,sx:Ue,children:e.jsx("iframe",{src:d,loading:"lazy"})})}function Ve(){const{t:a}=y(),t=G(),{company:o,templates:m}=I(s=>s.ticket),{templates:r,isLoading:d}=X(o),[i,p]=j.useState(),l=(s,n)=>{const h=r.find(x=>x.filename===n);t(ve({id:s,line:n,name:h==null?void 0:h.name}))},u=s=>{i&&t(q({id:i,param:s})),p(void 0)};return e.jsxs($,{as:"section",mt:3,position:"relative",children:[d&&e.jsx(ge,{isIndeterminate:!0}),e.jsxs(O,{children:[e.jsx(E,{as:"h5",size:"sm",mb:2,children:a("Add or update templates")}),e.jsx(ne,{hasArrow:!0,label:a("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:e.jsx("span",{children:e.jsx(U,{as:Ie,ml:1})})})]}),m.map(s=>e.jsx(Ae,{company:o,templateEntry:s,onLineChange:n=>l(s.id,n),onNewLineChange:n=>t(fe({id:s.id,newLine:n})),onMajorFlagChange:n=>t(ze({id:s.id,majorUpdate:n})),onLineNameChange:(n,h)=>t(je({id:s.id,lang:n,name:h})),onParamChange:n=>t(q({id:s.id,param:n})),onParamImport:()=>p(s.id),onRemove:()=>t(xe(s.id))},s.id)),e.jsx(R,{justifyContent:"flex-end",children:e.jsx(z,{variant:"ghost",size:"sm",leftIcon:e.jsx(Te,{}),onClick:()=>t(He()),children:a("Add item")})}),e.jsx(Je,{templateId:i,onClose:()=>p(void 0),onImport:u})]})}function Ge(a){const{companyErrors:t,templateErrors:o,onClose:m}=a,{t:r}=y(),d=D();return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(w,{children:r("Your inputs contain the following errors. Please fix it before submitting.")}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(E,{as:"h5",size:"sm",my:2,children:r("Railway company")}),e.jsx(A,{"aria-label":"List of company errors",children:t.map((i,p)=>e.jsx(b,{children:d(K[i])},p))})]}),Object.values(o).flat().length>0&&e.jsxs(e.Fragment,{children:[e.jsx(E,{as:"h5",size:"sm",my:2,children:r("Templates")}),e.jsx(A,{"aria-label":"List of template errors",children:Object.entries(o).map(([i,p])=>e.jsxs(b,{children:[i,e.jsx(A,{children:p.map((l,u)=>e.jsx(b,{children:d(K[l])},u))})]},i))})]})]}),e.jsx(V,{children:e.jsx(R,{children:e.jsx(z,{colorScheme:"primary",onClick:m,children:r("Go back")})})})]})}function De(a){const{justification:t,majorUpdateJustifications:o,onJustificationChange:m,onMajorUpdateJustificationChange:r,onNext:d}=a,{t:i}=y(),p=[{type:"textarea",value:t,label:i("Justification"),placeholder:i("Briefly describe your changes and provide justification"),onChange:m}],l=Object.entries(o).map(([s,n])=>({type:"textarea",value:n,label:i("Justification for major update of")+" "+s,placeholder:i("Briefly describe your changes and provide justification"),onChange:h=>r(s,h)})),u=!t||Object.values(o).some(s=>!s);return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(w,{children:i("Please provide suitable source and justification.")}),e.jsx(N,{fields:[...p,...l],minW:"full"})]}),e.jsx(V,{children:e.jsx(z,{colorScheme:"primary",onClick:d,rightIcon:e.jsx(Be,{}),isDisabled:u,children:i("Next")})})]})}function We(a){var x;const{companyName:t,companyBlock:o,templateBlocks:m,justification:r,majorUpdateJustifications:d,onPrev:i,onClose:p}=a,{t:l}=y(),u=te("primary.500","primary.300"),s=[`**Justification:** ${r||"(REPLACE ME)"}`,Object.entries(d).map(([C,g])=>`- Major update of ${C}: ${g}`).join(`
`),ye,(x=o==null?void 0:o.outerHTML)!=null?x:"",...m.map(C=>C.outerHTML)].join(`

`),n=new URLSearchParams({template:"new-templates-request.md",label:"resources",title:"Resources: New templates of "+t}),h=async()=>{await navigator.clipboard.writeText(s)};return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:[e.jsx(w,{children:l("Follow the instructions below to open an Issue")+":"}),e.jsxs(se,{children:[e.jsxs(b,{children:[l("Open")," ",e.jsxs(oe,{color:u,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+n.toString(),isExternal:!0,children:["Issue: New Templates Request ",e.jsx(U,{as:Le})]})]}),e.jsxs(b,{children:[l("Click copy button and paste into issue body")," ",e.jsx(z,{size:"xs",leftIcon:e.jsx(Ee,{}),onClick:h,children:l("Copy")})]})]})]}),e.jsxs(V,{children:[e.jsx(z,{variant:"ghost",onClick:i,mr:"auto",leftIcon:e.jsx(Re,{}),children:l("Previous")}),e.jsx(z,{colorScheme:"primary",onClick:p,children:l("Close")})]})]})}function _e(a){const{isOpen:t,onClose:o}=a,{t:m}=y(),[r,d]=j.useState([]),[i,p]=j.useState({}),[l,u]=j.useState(""),[s,n]=j.useState({}),[h,x]=j.useState(!1),{companyConfig:C,templateList:g}=I(v=>v.app),H=I(v=>v.ticket),B=M.getCompanyEnglishName(H,C),L=M.getCompanyBlock(H),F=M.getTemplateBlocks(H);j.useEffect(()=>{if(t){d(M.getCompanyErrors(H)),p(M.getTemplateErrors(H));const v=M.getMajorUpdateNames(H,g).reduce((c,f)=>({...c,[f]:""}),{});n(v)}else u(""),n({}),x(!1)},[t]);const S=r.length>0||Object.values(i).flat().length>0,P=!S&&!h;return e.jsxs(ie,{blockScrollOnMount:!1,isOpen:t,onClose:o,scrollBehavior:"inside",children:[e.jsx(re,{}),e.jsxs(le,{children:[e.jsx(ce,{children:m("Submit templates")}),e.jsx(he,{}),S&&e.jsx(Ge,{companyErrors:r,templateErrors:i,onClose:o}),P&&e.jsx(De,{justification:l,majorUpdateJustifications:s,onJustificationChange:u,onMajorUpdateJustificationChange:(v,c)=>n(f=>({...f,[v]:c})),onNext:()=>x(!0)}),!S&&h&&e.jsx(We,{companyName:B,companyBlock:L,templateBlocks:F,justification:l,majorUpdateJustifications:s,onPrev:()=>x(!1),onClose:o})]})]})}const qe={px:2,pt:2,width:{base:"100%",md:520},"& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto"},"& > div:nth-of-type(2)":{my:2}};function Qe(){const{t:a}=y(),t=Se(),o=G(),[m,r]=j.useState(!1),d=()=>{T.isStandaloneWindow()?t("/"):T.openApp("rmg-templates")},i=()=>{o(ke()),T.event(Me.RESET_TICKETS,{})};return e.jsxs(Ce,{sx:qe,children:[e.jsxs(O,{children:[e.jsx(be,{}),e.jsx(Ve,{})]}),e.jsxs(O,{children:[e.jsx(z,{size:"sm",onClick:d,children:a("Back to list")}),e.jsxs(R,{ml:"auto",children:[e.jsx(z,{size:"sm",variant:"outline",onClick:i,children:a("Reset")}),e.jsx(z,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:a("Submit")})]})]}),e.jsx(_e,{isOpen:m,onClose:()=>r(!1)})]})}export{Qe as default};
