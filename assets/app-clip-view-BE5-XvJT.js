import{r as m,j as e,e as S,L as T,A as M,M as N,D as O,f as A,G as $,B as C}from"./mantine-Cs0BQ6G7.js";import{P as w,T as b}from"./templates-grid-Bc9-sDlc.js";import{u as D,E as i}from"./index-BE0LOBMj.js";import{u as V,p as B,r as n}from"./react-DO1m31f8.js";import{u as G}from"./use-templates-D7dfYJHO.js";const W="_alert_19801_1",k={alert:W},z="rmg-templates-bridge--";function J(){const{t:o}=V(),p=G(),[d]=B(),E=d.get("parentId"),r=d.get("parentComponent"),{selectedCompany:a,coreCompanyConfig:h,otherCompanyConfig:P}=D(t=>t.app),[l,c]=n.useState(),[v,u]=n.useState(!1),[x,f]=n.useState(!1),s=n.useRef(null);n.useEffect(()=>{s.current=new BroadcastChannel(z+E),m.event(i.APP_CLIP_VIEW_OPENED,{parentComponent:r}),console.log(`[${s.current?.name}] App clip connection established, parentComponent=${r}`);const t=document.createElement("style");return t.textContent=".rmg-window__header{margin-left: unset;}",document.head.appendChild(t),()=>{s.current?.close(),document.head.removeChild(t)}},[]),n.useEffect(()=>{c(void 0)},[a]);const I=async()=>{if(!l)return;const{filename:t,name:_}=l;console.log(`[${s.current?.name}] Emitting IMPORT event, company=${a}, template=${t}`);const y=[...h,...P].find(g=>g.id===a)?.name??{},L=p(y)+" "+p(_);try{u(!0);const R=await(await fetch(`/rmg-templates/resources/templates/${a}/${t}.json`)).json();s.current?.postMessage({event:"IMPORT",meta:{company:a,filename:t,name:L},data:R}),m.event(i.APP_CLIP_VIEW_IMPORT,{parentComponent:r,company:a,filename:t})}catch{f(!0)}finally{u(!1),c(void 0)}},j=()=>{console.log(`[${s.current?.name}] Emitting CLOSE event`),s.current?.postMessage({event:"CLOSE"}),m.event(i.APP_CLIP_VIEW_CLOSED,{parentComponent:r}),c(void 0),f(!1)};return e.jsxs(S,{children:[e.jsx(T,{visible:v}),x&&e.jsx(M,{variant:"light",color:"red",title:o("Error"),icon:e.jsx(N,{}),className:k.alert,children:o("Unable to import selected template.")}),e.jsx(w,{}),e.jsx(b,{selectedTemplate:l,onTemplateSelect:c}),e.jsx(O,{}),e.jsx(A,{children:e.jsxs($,{ml:"auto",gap:"sm",children:[e.jsx(C,{variant:"default",size:"sm",onClick:j,children:o("Close")}),e.jsx(C,{variant:"filled",size:"sm",disabled:!l,onClick:I,children:o("Import")})]})})]})}export{J as default};
