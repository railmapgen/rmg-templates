System.register(["./chakra-legacy-DD_EbsbY.js","./index-legacy-Y3AY1tHj.js","./react-legacy-MOpOoUDF.js","./use-templates-legacy-UZUCGGcb.js"],(function(e,n){"use strict";var t,a,i,s,o,l,r,c,d,h,p,m,u,g,j,f,x,v,C,y,b,w,O,z,k,S,L,N,M,R,B,I,E,H,P,A,T,U,V,F,J,W,D,G,$,q,Y,_,Z,K,X,Q,ee,ne,te,ae,ie,se,oe,le,re,ce;return{setters:[e=>{t=e.a2,a=e.j,i=e.d,s=e.Z,o=e.E,l=e.a3,r=e.X,c=e.c,d=e.a4,h=e.a5,p=e.s,m=e.a6,u=e.r,g=e.a7,j=e.a8,f=e.t,x=e.v,v=e.a9,C=e.L,y=e.aa,b=e.M,w=e.ab,O=e.p,z=e.q,k=e.e},e=>{S=e.L,L=e.S,N=e.d,M=e.u,R=e.e,B=e.f,I=e.g,E=e.h,H=e.i,P=e.c,A=e.j,T=e.k,U=e.r,V=e.l,F=e.a,J=e.m,W=e.n,D=e.o,G=e.p,$=e.q,q=e.t,Y=e.v,_=e.w,Z=e.I,K=e.x,X=e.G,Q=e.y,ee=e.R,ne=e.z,te=e.E},e=>{ae=e.u,ie=e.r,se=e.p},e=>{oe=e.u,le=e.R,re=e.a,ce=e.b}],execute:function(){function n(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}}]})(e)}function de(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"}}]})(e)}function he(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 19H5V5h7V3H5a2 2 0 00-2 2v14a2 2 0 002 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}}]})(e)}function pe(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}}]})(e)}function me(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}}]})(e)}function ue(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"}}]})(e)}function ge(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}}]})(e)}function je(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}}]})(e)}function fe(e){return t({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}}]})(e)}function xe(e){const{optionalName:t,onChange:r}=e,{t:c}=ae(),d=oe(),h=(e,n)=>[{type:"select",label:c("Language"),value:e,options:Object.entries(S).reduce(((e,n)=>({...e,[n[0]]:d(n[1])})),{}),disabledOptions:Object.keys(S).filter((e=>L.includes(e)||t.some((n=>n[0]===e)))).filter((n=>n!==e)),onChange:n=>m(e,n)},{type:"input",label:c("Name"),value:n,onChange:n=>u(e,n),validator:e=>!!e}],p=()=>{const e=Object.keys(S).filter((e=>!L.includes(e)&&!t.some((n=>n[0]===e))));e.includes("ko")?r([...t,["ko",""]]):r([...t,[e[0],""]])},m=(e,n)=>{r(t.map((t=>t[0]===e?[n,t[1]]:t)))},u=(e,n)=>{r(t.map((t=>t[0]===e?[t[0],n]:t)))};return a.jsxs(a.Fragment,{children:[0===t.length&&a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(pe,{}),onClick:p,w:"100%",my:2,children:c("Add more translations")}),t.map((([e,i],d,m)=>a.jsxs(s,{sx:{w:"100%","& > div:first-of-type":{flex:1}},children:[a.jsx(le,{fields:h(e,i),noLabel:d>0}),d===m.length-1?a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Add translation"),title:c("Add translation"),onClick:p,icon:a.jsx(pe,{})}):a.jsx(l,{minW:8}),a.jsx(o,{size:"sm",variant:"ghost","aria-label":c("Remove this translation"),title:c("Remove this translation"),onClick:()=>(e=>{r(t.filter((n=>n[0]!==e)))})(e),icon:a.jsx(n,{})})]},e)))]})}function ve(){const{t:e}=ae(),n=oe(),t=N(),{company:i,newCompany:s,companyName:o,companyOptionalName:l}=M((e=>e.ticket)),d=re(),h=[{type:"select",label:e("Company"),value:i,options:{...d,[e("New")]:{new:e("Add a company...")}},disabledOptions:[""],onChange:e=>t(R(e))},{type:"input",label:e("Company code"),placeholder:"e.g. mtr, gzmtr, shmetro",value:s,onChange:e=>t(B(e)),hidden:"new"!==i}],p=L.map((e=>({type:"input",label:n(S[e]),value:o[e],onChange:n=>t(I({lang:e,name:n}))})));return a.jsxs(E,{children:[a.jsx(H,{children:a.jsx(r,{as:"h5",size:"sm",children:e("Railway company")})}),a.jsx(c.div,{px:1,children:a.jsxs(P,{direction:"column",children:[a.jsx(le,{fields:h}),"new"===i&&a.jsx(le,{fields:p}),"new"===i&&a.jsx(xe,{optionalName:l,onChange:e=>t(A(e))})]})})]})}e("default",(function(){const{t:e}=ae(),n=se(),t=N(),[o,l]=ie.useState(!1);return a.jsxs(ee,{sx:Be,children:[a.jsxs(k,{children:[a.jsx(ve,{}),a.jsx(ke,{})]}),a.jsxs(k,{children:[a.jsx(i,{size:"sm",onClick:()=>{U.isStandaloneWindow()?n("/"):U.openApp("rmg-templates")},children:e("Back to list")}),a.jsxs(s,{ml:"auto",children:[a.jsx(i,{size:"sm",variant:"outline",onClick:()=>{t(ne()),U.event(te.RESET_TICKETS,{})},children:e("Reset")}),a.jsx(i,{size:"sm",colorScheme:"primary",onClick:()=>l(!0),children:e("Submit")})]})]}),a.jsx(Re,{isOpen:o,onClose:()=>l(!1)})]})}));const Ce=e=>new Promise((n=>{const t=new FileReader;t.onloadend=()=>n(t.result),t.readAsText(e)})),ye={position:"relative","& > div":{overflow:"hidden"},"& > div:last-of-type":{flex:1,alignItems:"center",justifyContent:"center",minW:120,"& input":{display:"none"}}};function be(e){const{company:n,templateEntry:t,onLineChange:l,onNewLineChange:r,onMajorFlagChange:c,onLineNameChange:m,onOptionalNameChange:u,onParamChange:g,onParamImport:j,onRemove:f}=e,{line:x,newLine:v,majorUpdate:C,templateName:y,optionalName:b,param:w}=t,{t:O}=ae(),z=oe(),{templates:k}=ce(n),N=ie.useRef(null),M={"":O("Please select..."),...""===n||"new"===n?{}:k.reduce(((e,n)=>({...e,[n.filename]:z(n.name)})),{}),new:O("Add a line...")},R=[{type:"select",label:O("Line"),value:x,options:M,disabledOptions:[""],onChange:e=>l(e),minW:150},{type:"input",label:O("Line code"),placeholder:"e.g. twl, gz1, sh1",value:v,onChange:e=>r(e),hidden:"new"!==x},{type:"custom",label:O("Major update"),component:a.jsx(T,{selections:[{label:O("Yes"),value:!0},{label:O("No"),value:!1}],defaultValue:C,onChange:e=>c(e)}),hidden:"new"===x}],B=L.map((e=>({type:"input",label:z(S[e]),value:y[e],onChange:n=>m(e,n)})));return a.jsxs(P,{sx:ye,children:[a.jsx(o,{size:"sm",variant:"ghost",icon:a.jsx(fe,{}),"aria-label":O("Remove this line"),title:O("Remove this line"),position:"absolute",top:0,right:0,zIndex:5,onClick:f}),a.jsxs(d,{spacing:0,children:[a.jsx(le,{fields:[...R,...B],minW:110}),a.jsx(xe,{optionalName:b,onChange:u})]}),a.jsx(d,{children:w?a.jsxs(a.Fragment,{children:[a.jsx(h,{as:ue,boxSize:10}),a.jsxs(p,{as:"i",fontSize:"xs",children:["(",O("Size"),": ",JSON.stringify(w).length," ",O("chars"),")"]}),a.jsx(i,{size:"sm",onClick:()=>g(void 0),children:O("Remove")})]}):a.jsxs(a.Fragment,{children:[a.jsx(p,{as:"i",fontSize:"sm",children:O("Import from")}),a.jsxs(s,{spacing:1,children:[a.jsx(i,{size:"sm",onClick:j,children:"RMG"}),a.jsx(i,{size:"sm",onClick:()=>{var e;return null===(e=N.current)||void 0===e?void 0:e.click()},children:O("Local")}),a.jsx("input",{ref:N,type:"file",accept:".json",onChange:async e=>{var n;const t=null===(n=e.target.files)||void 0===n?void 0:n[0];if(console.log("handleFileUpload():: received file",t),t){if("application/json"!==t.type)return alert("Invalid file type!"),void(e.target.value="");try{const e=await Ce(t);g(JSON.parse(e))}catch(a){alert("Invalid file!"),e.target.value=""}}}})]})]})})]})}const we="rmg-bridge--",Oe={h:500,maxH:"70%","& iframe":{h:"100%",w:"100%"}};function ze(e){const{templateId:n,onClose:t,onImport:i}=e,[s]=ie.useState(crypto.randomUUID()),o="/rmg/#/import?"+new URLSearchParams({parentComponent:U.getAppName(),parentId:s});return ie.useEffect((()=>{const e=new BroadcastChannel(we+s);return e.onmessage=e=>{const{event:n,data:a}=e.data;console.log("[rmg-templates] Received event from RMG app clip:",n),"CLOSE"===n?t():"IMPORT"===n&&i(a)},()=>{e.close()}}),[n]),a.jsx(V,{isOpen:!!n,onClose:t,sx:Oe,children:a.jsx("iframe",{src:o,loading:"lazy"})})}function ke(){const{t:e}=ae(),n=N(),{company:t,templates:o}=M((e=>e.ticket)),{templates:l,isLoading:d}=ce(t),[p,u]=ie.useState();return a.jsxs(E,{children:[d&&a.jsx(F,{isIndeterminate:!0}),a.jsxs(H,{children:[a.jsx(r,{as:"h5",size:"sm",children:e("Add or update templates")}),a.jsx(m,{hasArrow:!0,label:e("Toggling on 'Major update' will update the uploader field of the template and you are required enter extra justification for it."),children:a.jsx("span",{children:a.jsx(h,{as:de,ml:1})})})]}),a.jsx(c.div,{px:1,transform:"translateZ(0)",children:o.map((e=>a.jsx(be,{company:t,templateEntry:e,onLineChange:t=>((e,t)=>{const a=l.find((e=>e.filename===t));n(_({id:e,line:t,name:null==a?void 0:a.name}))})(e.id,t),onNewLineChange:t=>n(J({id:e.id,newLine:t})),onMajorFlagChange:t=>n(W({id:e.id,majorUpdate:t})),onLineNameChange:(t,a)=>n(D({id:e.id,lang:t,name:a})),onOptionalNameChange:t=>n(G({id:e.id,optionalName:t})),onParamChange:t=>n($({id:e.id,param:t})),onParamImport:()=>u(e.id),onRemove:()=>n(q(e.id))},e.id)))}),a.jsx(s,{justifyContent:"flex-end",children:a.jsx(i,{variant:"ghost",size:"sm",leftIcon:a.jsx(pe,{}),onClick:()=>n(Y()),children:e("Add item")})}),a.jsx(ze,{templateId:p,onClose:()=>u(void 0),onImport:e=>{p&&n($({id:p,param:e})),u(void 0)}})]})}function Se(e){const{companyErrors:n,templateErrors:t,onClose:o}=e,{t:l}=ae(),c=oe();return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(p,{children:l("Your inputs contain the following errors. Please fix it before submitting.")}),n.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Railway company")}),a.jsx(g,{"aria-label":"List of company errors",children:n.map(((e,n)=>a.jsx(j,{children:c(Z[e])},n)))})]}),Object.values(t).flat().length>0&&a.jsxs(a.Fragment,{children:[a.jsx(r,{as:"h5",size:"sm",my:2,children:l("Templates")}),a.jsx(g,{"aria-label":"List of template errors",children:Object.entries(t).map((([e,n])=>a.jsxs(j,{children:[e,a.jsx(g,{children:n.map(((e,n)=>a.jsx(j,{children:c(Z[e])},n)))})]},e)))})]})]}),a.jsx(f,{children:a.jsx(s,{children:a.jsx(i,{colorScheme:"primary",onClick:o,children:l("Go back")})})})]})}const Le=e=>{var n;return!(null===(n=e.match(/^https?:\/\//))||void 0===n||!n[0])};function Ne(e){const{haveBeenOpened:n,onHaveBeenOpenedChange:t,willBeOpened:s,onWillBeOpenedChange:o,refSource:l,onRefSourceChange:r,refLink:c,onRefLinkChange:d,justification:h,majorUpdateJustifications:m,onJustificationChange:g,onMajorUpdateJustificationChange:j,onNext:x}=e,{t:v}=ae(),C=oe(),y=[{label:v("Yes"),value:!0},{label:v("No"),value:!1}],b=Object.fromEntries([["",v("Please select...")],...Object.entries(K).map((([e,n],t)=>[e,`${t+1}. ${C(n)}`]))]),w=[{type:"custom",label:v("Have all of the lines been officially opened?"),component:a.jsx(T,{selections:y,defaultValue:n,onChange:t})},{type:"custom",label:v("Will they be opened soon? Are all of the station names finalised?"),component:a.jsx(T,{selections:y,defaultValue:s,onChange:o}),hidden:n},{type:"select",label:v("Reference source"),options:b,disabledOptions:[""],value:l,onChange:e=>r(e)},{type:"input",value:c,label:v("Reference link"),placeholder:v("Enter a valid URL, e.g.")+" https://en.wikipedia.org",onChange:d,validator:Le,isDisabled:"STATION_UPLOAD_IMAGE"===l},{type:"textarea",value:h,label:v("Justification"),placeholder:v("Briefly describe your changes and provide justification"),onChange:g}],O=Object.entries(m).map((([e,n])=>({type:"textarea",value:n,label:v("Justification for major update of")+" "+e,placeholder:v("Briefly describe your changes and provide justification"),onChange:n=>j(e,n)}))),z=!(n||s)||!("STATION_UPLOAD_IMAGE"===l||l&&c)||!h||Object.values(m).some((e=>!e));return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(p,{children:v("Please provide suitable source and justification.")}),a.jsx(le,{fields:[...w,...O],minW:"full"})]}),a.jsx(f,{children:a.jsx(i,{colorScheme:"primary",onClick:x,rightIcon:a.jsx(je,{}),isDisabled:z,children:v("Next")})})]})}function Me(e){var n;const{companyName:t,companyBlock:s,templateBlocks:o,haveBeenOpened:l,willBeOpened:r,refSource:c,refLink:d,justification:m,majorUpdateJustifications:g,onPrev:y,onClose:b}=e,{t:w}=ae(),O=oe(),z=x("primary.500","primary.300"),k=["**Lines opening status:** "+(l?"OPENED":r?"WILL BE OPENED SOON":"NOT READY FOR OPENING"),`**Reference source:** ${c?O(K[c]):"(Not Provided)"}`,`**Reference link:** ${d||"(Not Provided)"}`,`**Justification:** ${m||"(Not Provided)"}`,Object.entries(g).map((([e,n])=>`- Major update of ${e}: ${n}`)).join("\n"),X,null!==(n=null==s?void 0:s.outerHTML)&&void 0!==n?n:"",...o.map((e=>e.outerHTML))].join("\n\n"),S=new URLSearchParams({template:"new-templates-request.md",labels:"resources",title:"Resources: New templates of "+t});return a.jsxs(a.Fragment,{children:[a.jsxs(u,{children:[a.jsx(p,{children:w("Follow the instructions below to open an Issue")+":"}),a.jsxs(v,{children:[a.jsxs(j,{children:[w("Open")," ",a.jsxs(C,{color:z,href:"https://github.com/railmapgen/rmg-templates/issues/new?"+S.toString(),isExternal:!0,children:["Issue: New Templates Request ",a.jsx(h,{as:he})]})]}),a.jsxs(j,{children:[w("Click copy button and paste into issue body")," ",a.jsx(i,{size:"xs",leftIcon:a.jsx(me,{}),onClick:async()=>{await navigator.clipboard.writeText(k)},children:w("Copy")})]})]})]}),a.jsxs(f,{children:[a.jsx(i,{variant:"ghost",onClick:y,mr:"auto",leftIcon:a.jsx(ge,{}),children:w("Previous")}),a.jsx(i,{colorScheme:"primary",onClick:b,children:w("Close")})]})]})}function Re(e){const{isOpen:n,onClose:t}=e,{t:i}=ae(),[s,o]=ie.useState([]),[l,r]=ie.useState({}),[c,d]=ie.useState(!1),[h,p]=ie.useState(!1),[m,u]=ie.useState(""),[g,j]=ie.useState(""),[f,x]=ie.useState(""),[v,C]=ie.useState({}),[k,S]=ie.useState(!1),{coreCompanyConfig:L,otherCompanyConfig:N,templateList:R}=M((e=>e.app)),B=M((e=>e.ticket)),I=Q.getCompanyEnglishName(B,[...L,...N]),E=Q.getCompanyBlock(B),H=Q.getTemplateBlocks(B);ie.useEffect((()=>{if(n){o(Q.getCompanyErrors(B)),r(Q.getTemplateErrors(B));const e=Q.getMajorUpdateNames(B,R).reduce(((e,n)=>({...e,[n]:""})),{});C(e)}else d(!1),p(!1),u(""),x(""),C({}),S(!1)}),[n]);const P=s.length>0||Object.values(l).flat().length>0,A=!P&&!k;return a.jsxs(y,{blockScrollOnMount:!1,isOpen:n,onClose:t,scrollBehavior:"inside",children:[a.jsx(b,{}),a.jsxs(w,{children:[a.jsx(O,{children:i("Submit templates")}),a.jsx(z,{}),P&&a.jsx(Se,{companyErrors:s,templateErrors:l,onClose:t}),A&&a.jsx(Ne,{haveBeenOpened:c,onHaveBeenOpenedChange:d,willBeOpened:h,onWillBeOpenedChange:p,refSource:m,onRefSourceChange:u,refLink:g,onRefLinkChange:j,justification:f,majorUpdateJustifications:v,onJustificationChange:x,onMajorUpdateJustificationChange:(e,n)=>C((t=>({...t,[e]:n}))),onNext:()=>S(!0)}),!P&&k&&a.jsx(Me,{companyName:I,companyBlock:E,templateBlocks:H,haveBeenOpened:c,willBeOpened:h,refSource:m,refLink:g,justification:f,majorUpdateJustifications:v,onPrev:()=>S(!1),onClose:t})]})]})}const Be={width:{base:"100%",md:520},alignSelf:"center","& > div:first-of-type":{flexDirection:"column",flex:1,overflowY:"auto",bg:"inherit"},"& > div:nth-of-type(2)":{my:2}}}}}));
