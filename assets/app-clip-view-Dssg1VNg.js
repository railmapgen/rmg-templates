import{r as d,j as t,e as O,L as A,A as $,M as w,D as b,f as D,G as V,B as I}from"./mantine-BbW9TwCE.js";import{P as B,T as G}from"./templates-grid-Bj9q4IS7.js";import{u as W,E as u}from"./index-CwW-puR8.js";import{u as k,p as z,r as o}from"./react-DOMpNlHD.js";import{u as F}from"./use-templates-DiVeHr-r.js";const H="_alert_19801_1",U={alert:H},X="rmg-templates-bridge--";function Z(){const{t:r}=k(),f=F(),[g]=z(),j=g.get("parentId"),l=g.get("parentComponent"),{selectedCompany:n,coreCompanyConfig:_,otherCompanyConfig:y}=W(e=>e.app),[c,m]=o.useState(),[L,C]=o.useState(!1),[R,E]=o.useState(!1),s=o.useRef(null);o.useEffect(()=>{var a;s.current=new BroadcastChannel(X+j),d.event(u.APP_CLIP_VIEW_OPENED,{parentComponent:l}),console.log("[".concat((a=s.current)==null?void 0:a.name,"] App clip connection established, parentComponent=").concat(l));const e=document.createElement("style");return e.textContent=".rmg-window__header{margin-left: unset;}",document.head.appendChild(e),()=>{var i;(i=s.current)==null||i.close(),document.head.removeChild(e)}},[]),o.useEffect(()=>{m(void 0)},[n]);const S=async()=>{var h,P,v,x;if(!c)return;const{filename:e,name:a}=c;console.log("[".concat((h=s.current)==null?void 0:h.name,"] Emitting IMPORT event, company=").concat(n,", template=").concat(e));const i=(v=(P=[..._,...y].find(p=>p.id===n))==null?void 0:P.name)!=null?v:{},M=f(i)+" "+f(a);try{C(!0);const N=await(await fetch("/rmg-templates/resources/templates/".concat(n,"/").concat(e,".json"))).json();(x=s.current)==null||x.postMessage({event:"IMPORT",meta:{company:n,filename:e,name:M},data:N}),d.event(u.APP_CLIP_VIEW_IMPORT,{parentComponent:l,company:n,filename:e})}catch(p){E(!0)}finally{C(!1),m(void 0)}},T=()=>{var e,a;console.log("[".concat((e=s.current)==null?void 0:e.name,"] Emitting CLOSE event")),(a=s.current)==null||a.postMessage({event:"CLOSE"}),d.event(u.APP_CLIP_VIEW_CLOSED,{parentComponent:l}),m(void 0),E(!1)};return t.jsxs(O,{children:[t.jsx(A,{visible:L}),R&&t.jsx($,{variant:"light",color:"red",title:r("Error"),icon:t.jsx(w,{}),className:U.alert,children:r("Unable to import selected template.")}),t.jsx(B,{}),t.jsx(G,{selectedTemplate:c,onTemplateSelect:m}),t.jsx(b,{}),t.jsx(D,{children:t.jsxs(V,{ml:"auto",gap:"sm",children:[t.jsx(I,{variant:"default",size:"sm",onClick:T,children:r("Close")}),t.jsx(I,{variant:"filled",size:"sm",disabled:!c,onClick:S,children:r("Import")})]})})]})}export{Z as default};
